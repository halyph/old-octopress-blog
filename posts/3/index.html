
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Knowledge Is Everything</title>
  <meta name="author" content="Orest Ivasiv">

  
  <meta name="description" content="Scala language compiles sources code to Java bytecode. But, it has some nice scripting facilities. Let&rsquo;s review them. So, the scala command is &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://halyph.com/posts/3">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Knowledge Is Everything" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-54626671-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <!-- <header role="banner"><hgroup>
  <h1><a href="/">Knowledge Is Everything</a></h1>
  
</hgroup>

</header> -->
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:halyph.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/">
        <span class="blue_light">
            Knowledge Is Everything
        </span>
       
    </a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About me</a></li>
  <li><a href="http://halyph.blogspot.com">Old Blog</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/02/02/scripting-in-scala/">Scripting in Scala</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-02-02T00:18:00+02:00'><span class='date'><span class='date-month'>Feb</span> <span class='date-day'>2</span><span class='date-suffix'>nd</span>, <span class='date-year'>2015</span></span> <span class='time'>12:18 am</span></time>
        
           | <a href="/blog/2015/02/02/scripting-in-scala/#disqus_thread"
             data-disqus-identifier="http://halyph.com/blog/2015/02/02/scripting-in-scala/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="center" src="/images/blog/scala.png"></p>

<p>Scala language compiles sources code to Java bytecode.  But, it has some nice scripting facilities. Let&rsquo;s review them.</p>

<p>So, the <code>scala</code> command is also a shell-script wrapper around the java command.</p>

<p>According to official <a href="http://www.scala-lang.org/files/archive/nightly/docs-2.10.1/manual/html/scala.html">scala utility</a> documentation (here highlighted only post-related notes):</p>

<blockquote><p><code>scala [ &lt;option&gt; ]... [ &lt;torun&gt; &lt;argument&gt;... ]</code></p>

<p>The <code>scala</code> utility runs Scala code using a Java runtime environment.</p>

<p>If a <strong>script</strong> file is specified to run, then the file is read and all Scala statements and declarations in the file are processed in order. Any arguments specified will be available via the argsvariable.</p>

<p>Script files may have an <strong>optional header</strong> that is ignored if present. There are two ways to format the header: either beginning with #! and ending with !#, or beginning with ::#! and ending with ::!#.</p>

<p>Such a header must have each header boundary start at the beginning of a line. Headers can be used to make stand-alone script files, as shown in the examples below.</p>

<p>Here is a complete Scala script (<strong>check.sh</strong>) for Unix:</p>

<pre><code>#!/bin/sh
exec scala "$0" "$@"
!#
Console.println("Hello, world!")
argv.toList foreach Console.println
</code></pre>

<p>Here is a complete Scala script (<strong>check.bat</strong>) for MS Windows:</p>

<pre><code>::#!
@echo off
call scala %0 %*
goto :eof
::!#
Console.println("Hello, world!")
argv.toList foreach Console.println
</code></pre>

<p>If you want to use the compilation cache to speed up multiple executions of the script (<strong>check.sh</strong>), then add <strong>-savecompiled</strong> to the scala command:</p>

<pre><code>#!/bin/sh
exec scala -savecompiled "$0" "$@"
!#
Console.println("Hello, world!")
argv.toList foreach Console.println
</code></pre></blockquote>

<p>These tricks give us an ability to run Scala script as plain shell script. Also, based on the setting above this script can have input parameters and <em>almost</em> cross-platform (see script header differences for Linux <strong>.vs.</strong> Windows).</p>

<p>Now, we should save the mentioned above code snippet in some file (e.g. <strong>check.sh</strong>) and make it executable. This script can be run as any Linux shell script <code>./check.sh</code> (<code>check.bat</code> - Windows).</p>

<h2>Scala utility internals</h2>

<h3>Linux</h3>

<p>Linux script header uses the next items:</p>

<ul>
<li><code>#!</code> it&rsquo;s <a href="http://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a> interpreter directive</li>
<li><code>exec</code> is used to run <code>scala</code> without creation new process. Commands which go right after <code>exec</code> will not be executed</li>
<li><code>!#</code> is simple marker for <code>scala</code> utility (see notes below)</li>
</ul>


<p>E.g.
This script</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#! /bin/sh
</span><span class='line'>echo Header
</span><span class='line'>exec echo
</span><span class='line'>!#
</span><span class='line'>echo Body</span></code></pre></td></tr></table></div></figure>


<p>will have the next output</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./test.sh
</span><span class='line'>Header</span></code></pre></td></tr></table></div></figure>


<p>We will get error in case <code>exec</code> is removed:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#! /bin/sh
</span><span class='line'>echo Header
</span><span class='line'>!#
</span><span class='line'>echo Body</span></code></pre></td></tr></table></div></figure>


<p>Output</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>$ ./test.sh
</span><span class='line'>Header
</span><span class='line'>./test.sh: line 4: !#: command not found
</span><span class='line'>Body
</span></code></pre></td></tr></table></div></figure>


<h3>Windows</h3>

<p>Windows batch script header uses the next items:</p>

<ul>
<li><code>::</code> is a remark without displaying or executing that line when the batch file is run (see <a href="http://www.computerhope.com/batch.htm">Information on batch files</a>).</li>
<li><code>::#!</code>  is simple marker for <code>scala</code> utility (see notes below)</li>
<li><code>@echo off</code> disable echo</li>
<li><code>call</code> calls one batch program from another.</li>
<li><code>goto :eof</code> go to end of file</li>
<li><code>::!#</code> is simple marker for <code>scala</code> utility (see notes below)</li>
</ul>


<p>The OS-specific script settings were identified, now let&rsquo;s dive deeper to understand how <code>scala</code> utility works.</p>

<h3><code>scala</code> internals</h3>

<p>This utility performs the next flow to run script:</p>

<ol>
<li>Run <code>scala.tools.nsc.MainGenericRunner#process</code> and identify run target &ldquo;as Script&rdquo; (there are other targets) <code>ScriptRunner.runScriptAndCatch(settings, thingToRun, command.arguments)</code></li>
<li><code>ScriptRunner</code> creates temp file <code>File.makeTemp("scalacmd", ".scala")</code></li>
<li>Run compiler and clean script header</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class ScriptRunner extends HasCompileSocket {
</span><span class='line'>...
</span><span class='line'>  private def withCompiledScript(
</span><span class='line'>      settings: GenericRunnerSettings,
</span><span class='line'>      scriptFile: String)
</span><span class='line'>      (handler: String =&gt; Boolean): Boolean =
</span><span class='line'>    {
</span><span class='line'>      def mainClass = scriptMain(settings)
</span><span class='line'>  
</span><span class='line'>         val compiler = newGlobal(settings, reporter)
</span><span class='line'>         new compiler.Run compile List(scriptFile)</span></code></pre></td></tr></table></div></figure>




<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>class Global
</span><span class='line'>    /** If this compilation is scripted, convert the source to a script source. */
</span><span class='line'>    private def scripted(s: SourceFile) = s match {
</span><span class='line'>      case b: BatchSourceFile if settings.script.isSetByUser =&gt; ScriptSourceFile(b)
</span><span class='line'>      case _ =&gt; s
</span><span class='line'>    }
</span><span class='line'>
</span><span class='line'>    /** Compile abstract file until `globalPhase`, but at least
</span><span class='line'>     *  to phase "namer".
</span><span class='line'>     */
</span><span class='line'>    def compileLate(file: AbstractFile) {
</span><span class='line'>      if (!compiledFiles(file.path))
</span><span class='line'>        compileLate(new CompilationUnit(scripted(getSourceFile(file))))
</span><span class='line'>    }
</span></code></pre></td></tr></table></div></figure>


<ol>
<li>Cleanup shell script (remove header) via <code>SourceFile</code>. Now, it&rsquo;s clear why script&rsquo;s header have such <em>strange</em> closing markers (see line 21, <code>content drop headerLen</code> - actual header remove)</li>
</ol>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>object ScriptSourceFile {
</span><span class='line'>  /** Length of the script header from the given content, if there is one.
</span><span class='line'>   *  The header begins with "#!" or "::#!" and ends with a line starting
</span><span class='line'>   *  with "!#" or "::!#".
</span><span class='line'>   */
</span><span class='line'>  def headerLength(cs: Array[Char]): Int = {
</span><span class='line'>    val headerPattern = Pattern.compile("""((?m)^(::)?!#.*|^.*/env .*)(\r|\n|\r\n)""")
</span><span class='line'>    val headerStarts  = List("#!", "::#!")
</span><span class='line'>
</span><span class='line'>    if (headerStarts exists (cs startsWith _)) {
</span><span class='line'>      val matcher = headerPattern matcher cs.mkString
</span><span class='line'>      if (matcher.find) matcher.end
</span><span class='line'>      else throw new IOException("script file does not close its header with !# or ::!#")
</span><span class='line'>    }
</span><span class='line'>    else 0
</span><span class='line'>  }
</span><span class='line'>
</span><span class='line'>  def apply(file: AbstractFile, content: Array[Char]) = {
</span><span class='line'>    val underlying = new BatchSourceFile(file, content)
</span><span class='line'>    val headerLen = headerLength(content)
</span><span class='line'>    val stripped = new ScriptSourceFile(underlying, content drop headerLen, headerLen)
</span><span class='line'>
</span><span class='line'>    stripped
</span><span class='line'>  }</span></code></pre></td></tr></table></div></figure>


<h2>Add libraries to Scala script</h2>

<p>Scala script libraries (<strong>jar</strong>s) can be added in script&rsquo;s header section:</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>#!/bin/sh
</span><span class='line'>exec scala -classpath "lib/lib.1.jar:lib/lib.2.jar" "$0" "$@"
</span><span class='line'>!#</span></code></pre></td></tr></table></div></figure>


<h2>Summary</h2>

<p>There is nothing magical in Scala interpretation. Every single peace of code must be compiled. Such interesting <em>scripting</em> approach can be applied to Java as well.</p>

<p>Unfortunately, Scala is not looks like nice scripting language (because it&rsquo;s <strong>not</strong> designed for this use case). It will be uncomfortable &ldquo;scripting&rdquo; in Scala without IDE.</p>

<h2>References</h2>

<ul>
<li><a href="http://timperrett.com/2011/08/01/system-scripting-with-scala/">System Scripting with Scala</a></li>
<li><a href="http://www.scala-lang.org/files/archive/nightly/docs-2.10.1/manual/html/scala.html">scala utility</a></li>
<li><a href="http://en.wikipedia.org/wiki/Shebang_(Unix)">shebang</a></li>
<li><a href="http://www.computerhope.com/batch.htm">Information on batch files</a></li>
<li>Scala Sources:

<ul>
<li><a href="https://github.com/scala/scala/blob/v2.11.5/src/compiler/scala/tools/nsc/ScriptRunner.scala#">ScriptRunner.scala</a></li>
<li><a href="https://github.com/scala/scala/blob/v2.11.5/src/reflect/scala/reflect/internal/util/SourceFile.scala">SourceFile.scala</a></li>
<li><a href="https://github.com/scala/scala/blob/v2.11.5/src/compiler/scala/tools/nsc/Global.scala">Global.scala</a></li>
</ul>
</li>
</ul>

</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/blog/2015/01/22/how-to-use-embedded-h2-with-h2-console/">How to Use Embedded H2 With Web Console?</a></h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-01-22T00:55:03+02:00'><span class='date'><span class='date-month'>Jan</span> <span class='date-day'>22</span><span class='date-suffix'>nd</span>, <span class='date-year'>2015</span></span> <span class='time'>12:55 am</span></time>
        
           | <a href="/blog/2015/01/22/how-to-use-embedded-h2-with-h2-console/#disqus_thread"
             data-disqus-identifier="http://halyph.com/blog/2015/01/22/how-to-use-embedded-h2-with-h2-console/">Comments</a>
        
      </p>
    
  </header>


  <div class="entry-content"><p><img class="center" src="/images/blog/java.png"></p>

<p>There are several Java SQL databases which supports both server and embedded modes: <a href="http://www.h2database.com/">H2</a>, <a href="http://hsqldb.org/">HSQLDB</a> and <a href="http://db.apache.org/derby/">Derby</a>. The most interesting for me is H2 with own web <a href="http://www.h2database.com/html/quickstart.html#h2_console">Console</a>.</p>

<p>The aim of this post is to show how to connect from H2 Console to embedded in-memory H2.</p>

<blockquote><p>H2 currently supports three servers: a web server (for the H2 Console), a TCP server (for client/server connections) and an PG server (for PostgreSQL clients). <strong>Please note that only the web server supports browser connections.</strong> The servers can be started in different ways, one is using the Server tool. Starting the server doesn&rsquo;t open a database - databases are opened as soon as a client connects.</p></blockquote>

<p>The next steps have to be performed to connect to embedded DB and populate initial data:</p>

<ol>
<li>Load DB driver</li>
<li>Get <code>Connection</code></li>
<li>Create <code>Statement</code> and <code>executeUpate</code> queries</li>
<li>Create TCP <code>Server</code>. <em>We should start serve to make in-memory DB available for another process</em></li>
</ol>


<h3>Let&rsquo;s try to implement this:</h3>

<ul>
<li>Run sample application</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DBNAME</span> <span class="o">=</span> <span class="s">&quot;mytest&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">SQLException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>        <span class="c1">// open the in-memory database within a VM</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&quot;org.h2.Driver&quot;</span><span class="o">);</span> <span class="c1">// (1)</span>
</span><span class='line'>        <span class="n">Connection</span> <span class="n">conn</span>
</span><span class='line'>          <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="s">&quot;jdbc:h2:mem:&quot;</span> <span class="o">+</span> <span class="n">DBNAME</span><span class="o">,</span> <span class="s">&quot;sa&quot;</span><span class="o">,</span> <span class="s">&quot;sa&quot;</span><span class="o">);</span> <span class="c1">// (2)</span>
</span><span class='line'>        <span class="c1">// username:password are very important and must be used for connecting via H2 Console</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Statement</span> <span class="n">stat</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span> <span class="c1">// (3)</span>
</span><span class='line'>        <span class="n">stat</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="s">&quot;create table mytbl(id int primary key, name varchar(255))&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">stat</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="s">&quot;insert into mytbl values(1, &#39;Hello&#39;)&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">stat</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="s">&quot;insert into mytbl values(2, &#39;World&#39;)&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// Verify that sample data was really inserted</span>
</span><span class='line'>        <span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="s">&quot;select * from mytbl&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;ResultSet output:&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="k">while</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;&gt; &quot;</span> <span class="o">+</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">));</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// start a TCP server</span>
</span><span class='line'>        <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="o">.</span><span class="na">createTcpServer</span><span class="o">().</span><span class="na">start</span><span class="o">();</span> <span class="c1">// (4)</span>
</span><span class='line'>        <span class="c1">// .. use in embedded mode ..</span>
</span><span class='line'>
</span><span class='line'>        <span class="c1">// or use it from another process:</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Server started and connection is open.&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;URL: jdbc:h2:&quot;</span> <span class="o">+</span> <span class="n">server</span><span class="o">.</span><span class="na">getURL</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;/mem:&quot;</span> <span class="o">+</span> <span class="n">DBNAME</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;\n&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
</span><span class='line'>                <span class="s">&quot;now start the H2 Console in another process using:\n&quot;</span> <span class="o">+</span>
</span><span class='line'>                <span class="s">&quot;$ cd h2/bin; java -cp h2-1.4.185.jar org.h2.tools.Console -web -browser&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Press [Enter] to stop.&quot;</span><span class="o">);</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Stopping server and closing the connection&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">rs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>        <span class="n">server</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</span><span class='line'>        <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Server is STOPPED&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>Output for previous run:</li>
</ul>


<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="n">ResultSet</span> <span class="nl">output:</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">Hello</span>
</span><span class='line'><span class="o">&gt;</span> <span class="n">World</span>
</span><span class='line'><span class="n">Server</span> <span class="n">started</span> <span class="n">and</span> <span class="n">connection</span> <span class="n">is</span> <span class="n">open</span><span class="o">.</span>
</span><span class='line'><span class="nl">URL:</span> <span class="nl">jdbc:h2:tcp:</span><span class="c1">//192.168.1.100:9092/mem:mytest</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="n">now</span> <span class="n">start</span> <span class="n">the</span> <span class="n">H2</span> <span class="n">Console</span> <span class="n">in</span> <span class="n">another</span> <span class="n">process</span> <span class="nl">using:</span>
</span><span class='line'><span class="n">$</span> <span class="n">cd</span> <span class="n">h2</span><span class="o">/</span><span class="n">bin</span><span class="o">;</span> <span class="n">java</span> <span class="o">-</span><span class="n">cp</span> <span class="n">h2</span><span class="o">-</span><span class="mf">1.4</span><span class="o">.</span><span class="mi">185</span><span class="o">.</span><span class="na">jar</span> <span class="n">org</span><span class="o">.</span><span class="na">h2</span><span class="o">.</span><span class="na">tools</span><span class="o">.</span><span class="na">Console</span> <span class="o">-</span><span class="n">web</span> <span class="o">-</span><span class="n">browser</span>
</span><span class='line'><span class="n">Press</span> <span class="o">[</span><span class="n">Enter</span><span class="o">]</span> <span class="n">to</span> <span class="n">stop</span><span class="o">.</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>We assume that h2 installation bundle (zip file) was downloaded (from <a href="http://www.h2database.com/html/download.html">http://www.h2database.com/html/download.html</a>) beforehand and unpacked in some folder</li>
<li>Go into H2 &ldquo;install/unpack&rdquo; folder and run the next command <code>cd h2/bin; java -cp h2-1.4.185.jar org.h2.tools.Console -web -browser</code></li>
<li>Now we should copy URL (from sample App output) and credentials sa/sa to login into Console

<ul>
<li><strong>URL:</strong> jdbc:h2:tcp://192.168.1.100:9092/mem:mytest</li>
<li><strong>Username:</strong> sa</li>
<li><strong>Password:</strong> sa</li>
</ul>
</li>
<li>Login window (opened from shell by <code>org.h2.tools.Console</code>)
<img class="left" src="/images/posts/h2console_login.png"></li>
</ul>


<p>Verify that our custom table contains just inserted values
<img class="left" src="/images/posts/h2console_sqlwindow.png"></p>

<h3>Add Embedded TCP and Web Servers</h3>

<p>Now, it&rsquo;s time to add small improvements.
The idea is to switch <em>on</em> H2 Console <strong>Web Server</strong> and <strong>TCP Server</strong> to have external access.
We should add/update item (4) in previous code snippets like this</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DBNAME</span> <span class="o">=</span> <span class="s">&quot;mytest&quot;</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">SQLException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'>
</span><span class='line'>        <span class="n">Server</span> <span class="n">webServer</span> <span class="o">=</span> <span class="n">Server</span><span class="o">.</span><span class="na">createWebServer</span><span class="o">(</span><span class="s">&quot;-webAllowOthers&quot;</span><span class="o">,</span><span class="s">&quot;-webPort&quot;</span><span class="o">,</span><span class="s">&quot;8082&quot;</span><span class="o">).</span><span class="na">start</span><span class="o">();</span> <span class="c1">// (4a)</span>
</span><span class='line'>        <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="o">.</span><span class="na">createTcpServer</span><span class="o">(</span><span class="s">&quot;-tcpAllowOthers&quot;</span><span class="o">,</span><span class="s">&quot;-tcpPort&quot;</span><span class="o">,</span><span class="s">&quot;9092&quot;</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>    <span class="c1">// (4b)</span>
</span><span class='line'>        <span class="c1">// .. use in embedded mode ..</span>
</span><span class='line'><span class="o">...</span>
</span><span class='line'>        <span class="n">server</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</span><span class='line'>        <span class="n">webServer</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</span><span class='line'>        <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Server is STOPPED&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<ul>
<li>After this we can access to Web Console without running external service

<ul>
<li>Simply use URL in  browser (access to <strong>Web Server</strong>): <a href="http://localhost:8082/">http://localhost:8082/</a></li>
</ul>
</li>
<li>Use any JDBC client (see IntelliJ IDEA as a sample below)

<ul>
<li>access to <strong>TCP Server</strong>
<img class="left" src="/images/posts/h2console_idea.png"></li>
</ul>
</li>
</ul>


<h2>References</h2>

<ol>
<li><a href="http://stackoverflow.com/questions/5077584/h2-database-in-memory-mode-cannot-be-accessed-by-console">H2 database in memory mode cannot be accessed by Console</a></li>
<li><a href="http://www.h2database.com/html/tutorial.html">Official H2 Tutorial</a></li>
<li><a href="http://h2database.com/javadoc/org/h2/tools/Server.html">H2 Server methods</a></li>
<li><a href="https://github.com/halyph/tutorials/tree/master/h2-embedded-console">GitHub Sources</a></li>
</ol>

</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/posts/4">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/posts/2">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p> <img class="left" src="/images/blog.jpeg">
 Orest Ivasiv <br />Software Engineer</p>
  <br />
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/02/17/how-to-install-octopress-on-windows/">How to Install Octopress on Windows?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/13/maven-flow-for-simple-app-creation/">Maven Flow for Simple App Creation</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/13/do-we-need-java-for-everything/">Do We Need Java for Everything?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/05/how-to-generate-permgen/">How to Generate PermGen Leak?</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/02/scripting-in-scala/">Scripting in Scala</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
    <span id="tag-cloud"><a href='/blog/categories/bash' style='font-size: 124.0%'>bash(2)</a> <a href='/blog/categories/blog' style='font-size: 112.0%'>blog(1)</a> <a href='/blog/categories/books' style='font-size: 124.0%'>books(2)</a> <a href='/blog/categories/conference' style='font-size: 112.0%'>conference(1)</a> <a href='/blog/categories/groovy' style='font-size: 136.0%'>groovy(3)</a> <a href='/blog/categories/h2' style='font-size: 112.0%'>h2(1)</a> <a href='/blog/categories/java' style='font-size: 160.0%'>java(5)</a> <a href='/blog/categories/java-se' style='font-size: 124.0%'>java se(2)</a> <a href='/blog/categories/jdbc' style='font-size: 112.0%'>jdbc(1)</a> <a href='/blog/categories/jeeconf' style='font-size: 112.0%'>jeeconf(1)</a> <a href='/blog/categories/languages' style='font-size: 112.0%'>languages(1)</a> <a href='/blog/categories/learning' style='font-size: 112.0%'>learning(1)</a> <a href='/blog/categories/maven' style='font-size: 112.0%'>maven(1)</a> <a href='/blog/categories/octopress' style='font-size: 124.0%'>octopress(2)</a> <a href='/blog/categories/review' style='font-size: 124.0%'>review(2)</a> <a href='/blog/categories/ruby' style='font-size: 124.0%'>ruby(2)</a> <a href='/blog/categories/scala' style='font-size: 112.0%'>scala(1)</a> <a href='/blog/categories/scripting' style='font-size: 112.0%'>scripting(1)</a> <a href='/blog/categories/shell' style='font-size: 124.0%'>shell(2)</a> <a href='/blog/categories/textmate' style='font-size: 124.0%'>textmate(2)</a> <a href='/blog/categories/tomcat' style='font-size: 112.0%'>tomcat(1)</a> <a href='/blog/categories/windows' style='font-size: 112.0%'>windows(1)</a> </span>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Orest Ivasiv -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'kie-by-halyph';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
