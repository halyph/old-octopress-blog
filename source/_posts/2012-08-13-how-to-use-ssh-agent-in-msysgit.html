---
layout: post
title: How to use SSH-Agent in msysgit?
date: '2012-08-13T19:33:00.002+03:00'
author: Orest Ivasiv
categories:
- git
- ssh
- ssh-agent
- msysgit
modified_time: '2012-08-14T11:28:25.893+03:00'
blogger_id: tag:blogger.com,1999:blog-7372777165432727866.post-8317511936549579711
blogger_orig_url: http://www.halyph.com/2012/08/how-to-use-ssh-agent-in-msysgit.html
---

<b>UPDATE</b> 08/14/12: changed .bashrc file<br /><br />I assume that You've generated and added SSH key as was described here: <a href="https://help.github.com/articles/generating-ssh-keys#platform-windows">Generating SSH Keys</a>.<br />It means you've got something like this in Yours user folder:<br /><br /><pre class="brush: bash;">[C:\Users\&lt;user_name&gt;\.ssh]<br />$ dir /b<br />id_rsa<br />id_rsa.pub<br />known_hosts<br /></pre>But, when You communicate with GitHub remote (via calling push/pull/fetch) You are getting the next message every time:  <br /><pre class="brush: bash;">Enter passphrase for key '/c/Users/&lt;user_name&gt;/.ssh/id_rsa':</pre>There is a simple <a href="http://anterence.blogspot.com/2012/01/ssh-agent-in-msysgit.html">solution</a>:<br /><ol><li>Add a file called <b>.bashrc</b> to my home folder (C:\Users\&lt;user_name&gt;\)</li><li><strike>Add the next content to this file:</strike></li><pre><strike>#! /bin/bash<br />eval `ssh-agent -s`<br />ssh-add</strike><br /></pre><li>Approach used in case #2 it dangerous because it create <span style="font-family: &quot;Courier New&quot;,Courier,monospace;">ssh-agent</span> instance every time you run msysgit shell.  I've <a href="https://help.github.com/articles/working-with-ssh-key-passphrases#platform-windows">tested the next (similar) solution from GitHub</a> again, very carefully and&nbsp; it DOES work. So, you have to create .bashrc (or .profile) file with the next content:</li><pre class="brush: bash;">#! /bin/bash<br />SSH_ENV="$HOME/.ssh/environment"<br /><br /># start the ssh-agent<br />function start_agent {<br />    echo "Initializing new SSH agent..."<br />    # spawn ssh-agent<br />    ssh-agent | sed 's/^echo/#echo/' &gt; "$SSH_ENV"<br />    echo succeeded<br />    chmod 600 "$SSH_ENV"<br />    . "$SSH_ENV" &gt; /dev/null<br />    ssh-add<br />}<br /><br /># test for identities<br />function test_identities {<br />    # test whether standard identities have been added to the agent already<br />    ssh-add -l | grep "The agent has no identities" &gt; /dev/null<br />    if [ $? -eq 0 ]; then<br />        ssh-add<br />        # $SSH_AUTH_SOCK broken so we start a new proper agent<br />        if [ $? -eq 2 ];then<br />            start_agent<br />        fi<br />    fi<br />}<br /><br /># check for running ssh-agent with proper $SSH_AGENT_PID<br />if [ -n "$SSH_AGENT_PID" ]; then<br />    ps -ef | grep "$SSH_AGENT_PID" | grep ssh-agent &gt; /dev/null<br />    if [ $? -eq 0 ]; then<br />  test_identities<br />    fi<br /># if $SSH_AGENT_PID is not properly set, we might be able to load one from<br /># $SSH_ENV<br />else<br />    if [ -f "$SSH_ENV" ]; then<br />  . "$SSH_ENV" &gt; /dev/null<br />    fi<br />    ps -ef | grep "$SSH_AGENT_PID" | grep ssh-agent &gt; /dev/null<br />    if [ $? -eq 0 ]; then<br />        test_identities<br />    else<br />        start_agent<br />    fi<br />fi<br /></pre></ol><br />From now on You have to enter passphrase only once when you start msysgit shell: <br /><pre class="brush: bash;">Welcome to Git (version 1.7.11-preview20120710)<br /><br /><br />Run 'git help git' to display the help index.<br />Run 'git help &lt;command&gt;' to display help for specific commands.<br />Initializing new SSH agent...<br />succeeded<br />Enter passphrase for /c/Users/&lt;user_name&gt;/.ssh/id_rsa:<br />Identity added: /c/Users/&lt;user_name&gt;/.ssh/id_rsa (/c/Users/&lt;user_name&gt;/.ssh/id_rsa)<br /></pre><br /><strike><b>Please note</b>: I've <a href="https://help.github.com/articles/working-with-ssh-key-passphrases#platform-windows">tested the next (similar) solution from GitHub</a> and it doesn't work.</strike> It works.<strike><br /></strike>