---
layout: post
title: Oracle UNDO DBF issues
date: '2010-04-30T01:58:00.007+03:00'
author: Orest Ivasiv
categories:
- DB
modified_time: '2010-10-26T01:32:17.152+03:00'
blogger_id: tag:blogger.com,1999:blog-7372777165432727866.post-3775835593711297850
blogger_orig_url: http://www.halyph.com/2010/04/oracle-undo-dbf-issues.html
---

Oracle 10.2 is installed on Windows XP SP3.<br /><br />Useful references:<br /><br />1. <a href="http://dbataj.blogspot.com/2007/01/switch-undo-tablespace.html">Switch Undo Tablespace</a><br />2. <a href="http://www.google.com/url?q=http%3A%2F%2Fprodlife.wordpress.com%2F2008%2F02%2F23%2Ffun-with-undo-tablespaces%2F&amp;sa=D&amp;sntz=1&amp;usg=AFrqEzewOhBQ8Arh8URMqDBjxM4uqtYRbA">Fun with UNDO tablespaces</a><br />3. <a href="http://arjudba.blogspot.com/2008/08/ora-01548-active-rollback-segment.html">ORA-01548: active rollback segment '_SYSSMU1$' found, terminate dropping tablespace</a><br />4. <a href="http://www.google.com/url?q=http%3A%2F%2Fpsoug.org%2Freference%2Finit_dot_ora.html&amp;sa=D&amp;sntz=1&amp;usg=AFrqEzdRT2zTihnnQA80ru3cpkRna7jG6g">Oracle Init.Ora &amp; SPFile</a><br />5. <a href="http://www.google.com/url?q=http%3A%2F%2Fwww.idevelopment.info%2Fdata%2FOracle%2FDBA_tips%2FDatabase_Administration%2FDBA_40.shtml%23Using%2520the%2520undo_tablespace%2520Parameter&amp;sa=D&amp;sntz=1&amp;usg=AFrqEzcQ6O9904RM5OP8ZJVZiepPb-wo-w">Automatic UNDO Management in Oracle9i</a><br /><br /><b>Problem description:</b><br />UNDO dbf file was f**ed up, it have to be removed and replaced.<br /><br />Create temp tablespace and switch UNDO to it:<br /><pre class="brush: plain">sqlplus&gt; create undo tablespace UNDO_RBS1 datafile 'path_to_new_undo_dbf' size 500M AUTOEXTEND ON MAXSIZE 3900M;<br />sqlplus&gt; alter system set undo_tablespace=UNDO_RBS1;<br /><br />sqlplus&gt; select status from v$rollstat;<br />STATUS<br />---------------<br />ONLINE<br />PENDING OFFLINE<br />PENDING OFFLINE<br />ONLINE<br />ONLINE<br />ONLINE<br />ONLINE<br />ONLINE<br />ONLINE<br />ONLINE<br />ONLINE</pre><b>You can't drop or offline if status show offline pending.</b><br />Restart DB:<br /><pre class="brush: plain;">sqlplus&gt; shutdown immediate;<br />sqlplus&gt; startup;<br /></pre>And now try to drop undo tablespace:<br /><pre class="brush: plain;">sqlplus&gt;alter tablespace UNDOTBS1 offline;<br />sqlplus&gt;drop tablespace UNDOTBS1 including contents and datafiles;<br />*<br />ERROR at line 1:<br />ORA-01548: active rollback segment '_SYSSMU1$' found, terminate dropping<br />tablespace<br /></pre><b>Cause of The Problem</b><br />An attempt was made to drop a tablespace that contains active rollback segments.<br /><br /><b>Solution of The Problem</b><br />In order to get rid of this error you have to follow following steps.<br /><br />1)Create pfile if you started with database with spfile.<br /><pre class="brush: plain;">sqlplus&gt; create PFILE from SPFILE;</pre>You can use the next command to get path to spfile (in my case pfile was located at "D:\oracle\product\10.2.0\admin\A7\pfile\init.ora.1252010112825" ):<br /><pre class="brush: plain;">sqlplus&gt; show parameter spfile</pre><br />2)Edit pfile and set undo management to manual.<br /><pre class="brush: plain;">undo_management = manual</pre><br />3)Put the entries of the undo segments in the pfile by using the following statement in the pfile:<br /><b style="font-family: inherit;">_CORRUPTED_ROLLBACK_SEGMENTS=(_SYSSMU1$,_SYSSMU2$,_SYSSMU3$,.....)</b><br /><pre class="brush: plain;">###########################################<br /># System Managed Undo and Rollback Segments<br />###########################################<br />undo_management=MANUAL<br />undo_tablespace=UNDOTBS1<br />_CORRUPTED_ROLLBACK_SEGMENTS=(_SYSSMU1$)<br /></pre><br />4)Mount the database using new pfile:<br /><pre class="brush: plain;">sqlplus&gt; shutdown immediate;<br />sqlplus&gt; startup mount pfile='fullpath to pfile'<br /></pre><br />5)Drop the undo segments,<br /><pre class="brush: plain;">sqlplus&gt; drop rollback segment "_SYSSMU1$";</pre><br />6) Drop Old undo tablespace.<br /><pre class="brush: plain;">sqlplus&gt; drop tablespace UNDOTBS1 including contents and datafiles;</pre><br />7) Add the new undo tablespace:<br /><pre class="brush: plain;">sqlplus&gt; create undo tablespace UNDOTBS1 datafile 'path to new undo table space' size 500M AUTOEXTEND ON MAXSIZE 32000M;<br />sqlplus&gt; alter system set undo_tablespace=UNDOTBS1;<br /></pre><br />8) Remove temp undo table space:<br /><pre class="brush: plain;">sqlplus&gt; alter tablespace UNDO_RBS1 offline;<br />sqlplus&gt; drop tablespace UNDO_RBS1 including contents and datafiles;<br />sqlplus&gt; shutdown immediate;<br /></pre><br />9) Change the pfile parameters back to Undo_management = AUTO and modify the parameter Undo_tablespace=new_undo_tablespace_name and remove the _corrupted_rollback_segments parameter:<br /><pre class="brush: plain;">###########################################<br /># System Managed Undo and Rollback Segments<br />###########################################<br />undo_management=AUTO<br />undo_tablespace=UNDOTBS1<br />#_CORRUPTED_ROLLBACK_SEGMENTS=(_SYSSMU1$)</pre><br />10) Startup the Database:<br /><pre class="brush: plain;">sqlplus&gt; startup</pre><br /><b>NOTE: In step #3 I've tried to use _OFFLINE_ROLLBACK_SEGMENT = (_syssmu1$). But it didn't work.</b>