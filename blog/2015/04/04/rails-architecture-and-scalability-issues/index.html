
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Rails Architecture and Scalability - Knowledge Is Everything</title>
  <meta name="author" content="Orest Ivasiv">

  
  <meta name="description" content="Rails deployment architecture Simple Rails Setup Typical Rails Setup Application server (Phusion Passenger) Recommended Rails Application Setups &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://halyph.com/blog/2015/04/04/rails-architecture-and-scalability-issues">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Knowledge Is Everything" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-54626671-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   >
  <!-- <header role="banner"><hgroup>
  <h1><a href="/">Knowledge Is Everything</a></h1>
  
</hgroup>

</header> -->
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:halyph.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
    <li><a href="/">
        <span class="blue_light">
            Knowledge Is Everything
        </span>
       
    </a></li>
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
  <li><a href="/about">About me</a></li>
  <li><a href="http://halyph.blogspot.com">Old Blog</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Rails Architecture and Scalability</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2015-04-04T19:17:12+03:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:17 pm</span></time>
        
           | <a href="#disqus_thread"
             data-disqus-identifier="http://halyph.com">Comments</a>
        
      </p>
    
  </header>


<div class="entry-content"><p><img class="right" src="/images/blog/ruby.png"></p>

<p><ul>
 <li>
 <ul>
  <li><a href="#Rails.deployment.architecture">Rails deployment architecture</a>
  <ul>
   <li><a href="#Simple.Rails.Setup">Simple Rails Setup</a></li>
   <li><a href="#Typical.Rails.Setup">Typical Rails Setup</a></li>
   <li><a href="#Application.server..Phusion.Passenger.">Application server (Phusion Passenger)</a></li>
  </ul>
  </li>
  <li><a href="#Recommended.Rails.Application.Setups">Recommended Rails Application Setups</a>
  <ul>
   <li><a href="#Small.Site">Small Site</a></li>
   <li><a href="#Medium.Site">Medium Site</a></li>
   <li><a href="#Large.Site">Large Site</a></li>
  </ul>
  </li>
  <li><a href="#Scale.up.Traditional.Rails.Application">Scale up Traditional Rails Application</a>
  <ul>
   <li><a href="#Caching">Caching</a></li>
   <li><a href="#Long-runnint.task.scaling">Long-runnint task scaling</a></li>
  </ul>
  </li>
  <li><a href="#Rails.moving.towards.SOA.and.micro.services">Rails moving towards SOA and micro services</a>
  <ul>
   <li><a href="#Splitting.application.into.small.pieces">Splitting application into small pieces</a></li>
   <li><a href="#Reference..sample..service.orienter...micro.service.architecture">Reference (sample) service orienter / micro service architecture</a>
   <ul>
    <li><a href="#Groupon">Groupon</a></li>
    <li><a href="#Flipcart">Flipcart</a></li>
    <li><a href="#Gilt">Gilt</a>
</li>
   </ul>
   </li>
  </ul>
  </li>
  <li><a href="#Conclusion">Conclusion</a></li>
  <li><a href="#Rails.related.tech.components">Rails related tech components</a>
  <ul>
   <li><a href="#Web.Servers...Proxy">Web Servers / Proxy</a></li>
   <li><a href="#Application.Servers">Application Servers</a></li>
   <li><a href="#Libraries...Tools">Libraries / Tools</a></li>
  </ul>
  </li>
  <li><a href="#References">References</a></li>
 </ul>
 </li>
</ul>

</p>

<p>Everybody know when this <em>&ldquo;Rails doesn&rsquo;t scale&rdquo;</em> has been begun:</p>

<ul>
<li><strong>2009</strong> <a href="http://www.artima.com/scalazine/articles/twitter_on_scala.html">Twitter message queue back-end moved from Ruby to Scala</a></li>
<li><strong>2011</strong> <a href="https://blog.twitter.com/2011/twitter-search-now-3x-faster">Twitter Search is Now 3x Faster</a></li>
</ul>


<blockquote><p>Panic, we must not use <strong>Ruby on Rails</strong> because Twitter had scalability problems.</p></blockquote>

<p>I&rsquo;m a Java developer who love Ruby language, but don&rsquo;t write anything in Rails. Despite this I&rsquo;ve decided to look into this famous <em>&ldquo;Rails doesn&rsquo;t scale&rdquo;</em> statement deeper to understand the root cause of this problem.</p>

<p>So, I <a href="https://github.com/halyph/architecture-case-study#ruby-on-rails-architecture-case-studies">collected</a> public available Ruby on Rails architecture and scalability case studies (videos of conference talks, reports and blog posts) and tried to extract the general patterns of architecture and scalability issues.</p>

<p>There are two type of scalability issues:</p>

<ol>
<li><strong>Application performance</strong> - when web application can&rsquo;t handle huge traffic</li>
<li><strong>Delivery velocity</strong> - when it&rsquo;s become hard to make changes in big Rails application, run quick tests, deploy it and manage big team</li>
</ol>


<p><em>Note</em>: You are not another &ldquo;twitter&rdquo; to worry about scalability issues right from beginning of the project (there are fewer web apps on the Internet to get enough traffic to even care about scalability). Your goal is to push your product as quick as possible.
But, in the same time you&rsquo;d like to use Rails (due to it&rsquo;s productivity) and make you potentially application scalable (in all possible terms)</p>

<p>The most interesting that scalability is about architecture, databases, caching, event queues, disk IO and less about Rails framework.</p>

<a name="Rails.deployment.architecture"></a>
<h2>Rails deployment architecture</h2>

<p>Let&rsquo;s review the common Rails deployment approaches (see <a href="http://www.slideshare.net/jweiss/deployment-with-ruby-on-rails">Deployment with Ruby on Rails</a>)</p>

<a name="Simple.Rails.Setup"></a>
<h3>Simple Rails Setup</h3>

<p>One Rails instance handles all requests. Rails is single-threaded: There is only one concurrent request.</p>

<p><img src="/images/posts/2015-04-04/pic1.jpg"></p>

<a name="Typical.Rails.Setup"></a>
<h3>Typical Rails Setup</h3>

<ul>
<li>A load-balancer distributes the incoming requests</li>
<li>Some load-balancers will deliver static requests themselves</li>
<li>Several Rails instances handle all requests</li>
<li>Number of concurrent requests equals number of Rails instances</li>
</ul>


<p><img src="/images/posts/2015-04-04/pic2.jpg"></p>

<a name="Application.server..Phusion.Passenger."></a>
<h3>Application server (Phusion Passenger)</h3>

<ul>
<li>Involving Phusion Passenger application server</li>
<li>Makes setup easier on the single machine level</li>
<li>Multiple servers still require load balancer</li>
<li>Suitable for mass-hosting</li>
<li>upcoming standard way of deploying Rails</li>
</ul>


<p><img src="/images/posts/2015-04-04/pic3.jpg"></p>

<a name="Recommended.Rails.Application.Setups"></a>
<h2>Recommended Rails Application Setups</h2>

<a name="Small.Site"></a>
<h3>Small Site</h3>

<p>Apache with mod_rails/Phusion Passenger</p>

<p><img src="/images/posts/2015-04-04/pic4.jpg"></p>

<a name="Medium.Site"></a>
<h3>Medium Site</h3>

<ul>
<li>Apache/Nginx as frontend proxy</li>
<li>Passanger as backend</li>
<li>Deliver static files with Apache/Nginx</li>
</ul>


<p><img src="/images/posts/2015-04-04/pic5.jpg"></p>

<a name="Large.Site"></a>
<h3>Large Site</h3>

<ul>
<li>Redundant load-ballancer</li>
<li>Redundant proxy</li>
<li>Phusion Passenger/mod_rails</li>
</ul>


<p><img src="/images/posts/2015-04-04/pic6.jpg"></p>

<a name="Scale.up.Traditional.Rails.Application"></a>
<h2>Scale up Traditional Rails Application</h2>

<a name="Caching"></a>
<h3>Caching</h3>

<p>There might be the cases when it&rsquo;s not enought and in this case we should start looking in &ldquo;cashing&rdquo; direction via involving Memcahed and/or Redis <em>(based on Konstantin’s Gredeskoul slides)</em></p>

<p><img src="/images/posts/2015-04-04/pic7.jpg"></p>

<a name="Long-runnint.task.scaling"></a>
<h3>Long-runnint task scaling</h3>

<p><em>(based on Konstantin’s Gredeskoul slides)</em></p>

<ul>
<li>Background jobs with Reques (it sits on top of Redis)</li>
<li>Use Solr/Elasticsearch instead of doing complex joins</li>
</ul>


<p><img src="/images/posts/2015-04-04/pic8.jpg"></p>

<a name="Rails.moving.towards.SOA.and.micro.services"></a>
<h2>Rails moving towards SOA and micro services</h2>

<p>The shown above architectures are related to <strong>Monolith Architecture</strong>. This type of architecture has some problems:</p>

<ul>
<li>Development pain points:</li>
<li>effective controllers and models have a lot of logic

<ul>
<li>~1000 Models/Controllers, 200K LOC, 100s of jobs</li>
</ul>
</li>
<li>Merge issues arise in big team (20-30+)</li>
<li>Lots of contributors and no ownership</li>
<li>Difficult deployments with long integration cycles</li>
<li>Tests are not green, it&rsquo;s really hard to support stable test quality</li>
</ul>


<p>The monolithic Rails app should evolve into ecosystems of connected services. It&rsquo;s becoming quite common for Rails apps to be working mainly as <a href="https://github.com/halyph/architecture-case-study/blob/master/rails-as-an-soa-client-by-pete-hodgson.md">clients</a> to other services.</p>

<a name="Splitting.application.into.small.pieces"></a>
<h3>Splitting application into small pieces</h3>

<ul>
<li>Split into smaller applications (based on Konstantin&rsquo;s Gredeskoul <a href="http://www.slideshare.net/kigster/enterprise-architectures-with-ruby-and-rails">slides</a>)

<ul>
<li>Contains web UI, logic and data

<ul>
<li>Extract look and feel into gem to share across apps</li>
</ul>
</li>
<li>May combine with other apps</li>
<li>May rely on common libraries</li>
<li>Typically run in their own Ruby VM</li>
</ul>
</li>
<li>Extract services and create APIs

<ul>
<li>Create client API wrapper gems for consumers</li>
</ul>
</li>
<li>Extract libraries (gems)

<ul>
<li>Create shared based client gem library</li>
</ul>
</li>
</ul>


<p><img src="/images/posts/2015-04-04/pic9.jpg"></p>

<a name="Reference..sample..service.orienter...micro.service.architecture"></a>
<h3>Reference (sample) service orienter / micro service architecture</h3>

<p>Now, we have more than one Rails application and many service which are communicating using messaging, distributed cashed, etc.</p>

<a name="Groupon"></a>
<h4><a href="https://github.com/halyph/architecture-case-study/blob/master/groupon.md">Groupon</a></h4>

<p><img src="/images/posts/2015-04-04/pic10.png"></p>

<a name="Flipcart"></a>
<h4><a href="https://github.com/halyph/architecture-case-study/blob/master/flipcart.md">Flipcart</a></h4>

<p><img src="/images/posts/2015-04-04/pic11.jpg"></p>

<a name="Gilt"></a>
<h4><a href="https://github.com/halyph/architecture-case-study/blob/master/gilt.md">Gilt</a></h4>

<p><img src="/images/posts/2015-04-04/pic12.jpg"></p>

<p>I&rsquo;ve collect much more case studies, see <a href="https://github.com/halyph/architecture-case-study#ruby-on-rails-architecture-case-studies">here</a>.</p>

<a name="Conclusion"></a>
<h2>Conclusion</h2>

<p>Moving Monolith Rails application to micro service architecture it&rsquo;s not one shot action. It&rsquo;s long run with lots of trade offs. And more over, micro service architecture is not silver bullet, it&rsquo;s just one alternative way to scale your application (see [Recommended Rails Application Setups][#Recommended.Rails.Application.Setups]).</p>

<p>The key idea is to develop your application with <a href="http://en.wikipedia.org/wiki/Single_responsibility_principle">SRP (Single responsibility principle)</a> in mind. The more modular your application the more scalable it&rsquo;s.</p>

<p>I&rsquo;m planning to add more architecture case studies to my <a href="https://github.com/halyph/architecture-case-study#ruby-on-rails-architecture-case-studies">collection</a> (not only Rails related). Stay tuned.</p>

<a name="Rails.related.tech.components"></a>
<h2>Rails related tech components</h2>

<p>Collection of major technology components mentioned in case studies.</p>

<a name="Web.Servers...Proxy"></a>
<h3>Web Servers / Proxy</h3>

<ul>
<li><a href="http://httpd.apache.org/">Apache</a></li>
<li><a href="http://nginx.org/">Nginx</a></li>
<li><a href="http://www.haproxy.org/">HAProxy</a></li>
</ul>


<a name="Application.Servers"></a>
<h3>Application Servers</h3>

<ul>
<li><a href="http://unicorn.bogomips.org/">Unicorn</a></li>
<li><a href="https://www.phusionpassenger.com">Phusion Passenger</a></li>
<li><a href="http://puma.io/">Puma</a></li>
<li><a href="http://code.macournoyer.com/thin/">Thin</a></li>
</ul>


<a name="Libraries...Tools"></a>
<h3>Libraries / Tools</h3>

<ul>
<li><a href="http://redis.io/">Redis</a></li>
<li><a href="http://memcached.org/">Memcached</a></li>
<li><a href="https://github.com/resque/resque">Reque</a></li>
<li><a href="http://sidekiq.org/">Sidekiq</a></li>
<li><a href="http://lucene.apache.org/solr/">Solr</a></li>
<li><a href="https://www.elastic.co/products/elasticsearch">Elasticsearch</a></li>
</ul>


<a name="References"></a>
<h2>References</h2>

<ul>
<li><a href="https://github.com/halyph/architecture-case-study#ruby-on-rails-architecture-case-studies">Collection of Ruby on Rails Architecture Case Studies</a>

<ul>
<li><a href="http://www.slideshare.net/jweiss/deployment-with-ruby-on-rails">Deployment with Ruby on Rails</a></li>
<li><a href="http://www.slideshare.net/kigster/enterprise-architectures-with-ruby-and-rails">Enterprise Architectures with Ruby (and Rails)</a></li>
</ul>
</li>
<li><a href="http://www.quora.com/Does-Ruby-on-Rails-scale">Does Ruby on Rails scale</a> - Quora</li>
<li>&ldquo;Keeping Your Massive Rails App From Turning Into a S#!t Show with Benjamin Smith&rdquo; (see <a href="https://vimeo.com/76094344">video</a> and <a href="https://speakerdeck.com/benjaminleesmith/keeping-your-massive-rails-app-from-turning-into-a-s-number-t-show-windycityrails-2013">slides</a>)</li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Orest Ivasiv</span></span>

      




<time class='entry-date' datetime='2015-04-04T19:17:12+03:00'><span class='date'><span class='date-month'>Apr</span> <span class='date-day'>4</span><span class='date-suffix'>th</span>, <span class='date-year'>2015</span></span> <span class='time'>7:17 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/architecture/'>architecture</a>, <a class='category' href='/blog/categories/rails/'>rails</a>, <a class='category' href='/blog/categories/ruby/'>ruby</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  <a href="//twitter.com/share" class="twitter-share-button" data-url="http://halyph.com/blog/2015/04/04/rails-architecture-and-scalability-issues/" data-via="halyph" data-counturl="http://halyph.com/blog/2015/04/04/rails-architecture-and-scalability-issues/" >Tweet</a>
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2015/03/17/how-to-download-jars-from-maven-central/" title="Previous Post: How to download jars from Maven Central">&laquo; How to download jars from Maven Central</a>
      
      
        <a class="basic-alignment right" href="/blog/2015/04/06/java-full-stack-web-framework/" title="Next Post: Java full stack web framework">Java full stack web framework &raquo;</a>
      
    </p>
  </footer>
</article>

  <section>
    <h1>Comments</h1>
    <div id="disqus_thread" aria-live="polite"><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
</div>
  </section>

</div>

<aside class="sidebar">
  
    <section>
  <h1>About Me</h1>
  <p> <img class="left" src="/images/blog.jpeg">
 Orest Ivasiv <br />Software Engineer</p>
  <br />
</section>
<section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2015/05/18/golang-presentation-tool/">Go Presentation Tool</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/06/java-full-stack-web-framework/">Java Full Stack Web Framework</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/04/04/rails-architecture-and-scalability-issues/">Rails Architecture and Scalability</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/03/17/how-to-download-jars-from-maven-central/">How to Download Jars From Maven Central</a>
      </li>
    
      <li class="post">
        <a href="/blog/2015/02/17/how-to-install-octopress-on-windows/">How to Install Octopress on Windows?</a>
      </li>
    
  </ul>
</section>
<section>
  <h1>Categories</h1>
    <span id="tag-cloud"><a href='/blog/categories/architecture' style='font-size: 107.5%'>architecture(1)</a> <a href='/blog/categories/bash' style='font-size: 115.0%'>bash(2)</a> <a href='/blog/categories/blog' style='font-size: 107.5%'>blog(1)</a> <a href='/blog/categories/books' style='font-size: 115.0%'>books(2)</a> <a href='/blog/categories/conference' style='font-size: 107.5%'>conference(1)</a> <a href='/blog/categories/golang' style='font-size: 107.5%'>golang(1)</a> <a href='/blog/categories/groovy' style='font-size: 122.5%'>groovy(3)</a> <a href='/blog/categories/h2' style='font-size: 107.5%'>h2(1)</a> <a href='/blog/categories/ivy' style='font-size: 107.5%'>ivy(1)</a> <a href='/blog/categories/java' style='font-size: 160.0%'>java(8)</a> <a href='/blog/categories/java-se' style='font-size: 115.0%'>java se(2)</a> <a href='/blog/categories/jdbc' style='font-size: 107.5%'>jdbc(1)</a> <a href='/blog/categories/jeeconf' style='font-size: 107.5%'>jeeconf(1)</a> <a href='/blog/categories/languages' style='font-size: 107.5%'>languages(1)</a> <a href='/blog/categories/learning' style='font-size: 107.5%'>learning(1)</a> <a href='/blog/categories/maven' style='font-size: 115.0%'>maven(2)</a> <a href='/blog/categories/octopress' style='font-size: 115.0%'>octopress(2)</a> <a href='/blog/categories/rails' style='font-size: 107.5%'>rails(1)</a> <a href='/blog/categories/review' style='font-size: 115.0%'>review(2)</a> <a href='/blog/categories/ruby' style='font-size: 122.5%'>ruby(3)</a> <a href='/blog/categories/scala' style='font-size: 107.5%'>scala(1)</a> <a href='/blog/categories/scripting' style='font-size: 107.5%'>scripting(1)</a> <a href='/blog/categories/shell' style='font-size: 115.0%'>shell(2)</a> <a href='/blog/categories/spring' style='font-size: 107.5%'>spring(1)</a> <a href='/blog/categories/textmate' style='font-size: 115.0%'>textmate(2)</a> <a href='/blog/categories/tomcat' style='font-size: 107.5%'>tomcat(1)</a> <a href='/blog/categories/windows' style='font-size: 107.5%'>windows(1)</a> </span>
</section>

  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2015 - Orest Ivasiv -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'kie-by-halyph';
      
        
        // var disqus_developer = 1;
        var disqus_identifier = 'http://halyph.com/blog/2015/04/04/rails-architecture-and-scalability-issues/';
        var disqus_url = 'http://halyph.com/blog/2015/04/04/rails-architecture-and-scalability-issues/';
        var disqus_script = 'embed.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>







  <script type="text/javascript">
    (function(){
      var twitterWidgets = document.createElement('script');
      twitterWidgets.type = 'text/javascript';
      twitterWidgets.async = true;
      twitterWidgets.src = '//platform.twitter.com/widgets.js';
      document.getElementsByTagName('head')[0].appendChild(twitterWidgets);
    })();
  </script>





</body>
</html>
