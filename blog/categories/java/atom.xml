<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">

  <title><![CDATA[Category: Java | Knowledge Is Everything]]></title>
  <link href="http://halyph.com/blog/categories/java/atom.xml" rel="self"/>
  <link href="http://halyph.com/"/>
  <updated>2015-02-21T16:42:19+02:00</updated>
  <id>http://halyph.com/</id>
  <author>
    <name><![CDATA[Orest Ivasiv]]></name>
    
  </author>
  <generator uri="http://octopress.org/">Octopress</generator>

  
  <entry>
    <title type="html"><![CDATA[Maven Flow for Simple App Creation]]></title>
    <link href="http://halyph.com/blog/2015/02/13/maven-flow-for-simple-app-creation/"/>
    <updated>2015-02-13T00:18:30+02:00</updated>
    <id>http://halyph.com/blog/2015/02/13/maven-flow-for-simple-app-creation</id>
    <content type="html"><![CDATA[<p><img class="center" src="/images/blog/java.png"></p>

<p>I provided my reflections about <em>&ldquo;Java for Everything&rdquo;</em> in the previous <a href="/blog/2015/02/13/do-we-need-java-for-everything">post</a>.
Here we will review other implementation of this concept.</p>

<p>I have the next concerns about any Java application (big or small):</p>

<ul>
<li>library dependency management must be simple</li>
<li>it&rsquo;s very bad practice to distribute sources along with libraries (dependency management tools must be used instead: Ivy, Maven, Gradle, etc.)</li>
<li>small application might have a little bit different project layout (not equals to traditional Maven layout)</li>
<li>we should be able to setup IDE (in my case <a href="https://www.jetbrains.com/idea/">Intellij IDEA</a>) as quick a possible. I hate editing Java programs in plain text editor</li>
<li>it must be a convenient way to run Java application with different arguments in <em>production</em> and <em>development</em> modes</li>
</ul>


<h2>Use Case</h2>

<p>We have to create simple and small REST application based on <a href="https://github.com/perwendel/spark">Spark Java framework</a> (A Sinatra inspired framework for Java).</p>

<p>Here is the source:
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">get</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">SparkBase</span><span class="o">.</span><span class="na">port</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span> <span class="n">String</span><span class="o">[]</span> <span class="n">args</span> <span class="o">)</span> <span class="kd">throws</span> <span class="n">NumberFormatException</span> <span class="o">{&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span>    <span class="nf">for</span><span class="o">(</span><span class="n">String</span> <span class="nl">arg:</span> <span class="n">args</span><span class="o">)</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;&amp;gt; %s&quot;</span><span class="o">,</span> <span class="n">arg</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">get</span><span class="o">(</span><span class="s">&quot;/hello&quot;</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;Hello World!&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="o">});</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;}</span> <span class="o">&lt;</span><span class="n">br</span><span class="o">/&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>So, here is the list of issues:</p>

<ul>
<li>get Spark dependency with all transitive dependencies</li>
<li>pass command-line arguments into the app</li>
<li>use this application in development mode and in &ldquo;production&rdquo; (packed in jar)</li>
</ul>


<h2>Traditional Maven Way</h2>

<ul>
<li><p>Generate empty project via Maven archetype
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>mvn archetype:generate <span class="se">\</span>
</span><span class='line'>-DgroupId<span class="o">=</span>com.halyph <span class="se">\</span>
</span><span class='line'>-DartifactId<span class="o">=</span>sparkblog <span class="se">\</span>
</span><span class='line'>-Dpackage<span class="o">=</span>com.halyph.blog <span class="se">\</span>
</span><span class='line'>-Dversion<span class="o">=</span>1.0-SNAPSHOT <span class="se">\</span>
</span><span class='line'>-DarchetypeGroupId<span class="o">=</span>org.apache.maven.archetypes <span class="se">\</span>
</span><span class='line'>-DarchetypeArtifactId<span class="o">=</span>maven-archetype-quickstart <span class="se">\</span>
</span><span class='line'>-DinteractiveMode<span class="o">=</span><span class="nb">false</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p></li>
<li><p>Open this in IDEA (I don&rsquo;t use other IDEs) via &ldquo;Open File or Project&rdquo; and select folder with generated <strong>pom.xml</strong> file. We don&rsquo;t need tests, so we can delete <em>src->test</em> folder and remove junit dependency from <strong>pom.xml</strong> file. Now, we can easily run our application via IDE.</p></li>
<li><p>Add Spark framework dependency to <strong>pom.xml</strong> and update our <strong>App</strong> class
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;project</span> <span class="na">xmlns=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="na">xmlns:xsi=</span><span class="s">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>
</span><span class='line'>       <span class="na">xsi:schemaLocation=</span><span class="s">&quot;http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span><span class="nt">&gt;</span>
</span><span class='line'><span class="nt">&lt;modelVersion&gt;</span>4.0.0<span class="nt">&lt;/modelVersion&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;groupId&gt;</span>com.halyph<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'><span class="nt">&lt;artifactId&gt;</span>sparkblog<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'><span class="nt">&lt;version&gt;</span>1.0-SNAPSHOT<span class="nt">&lt;/version&gt;</span>
</span><span class='line'><span class="nt">&lt;packaging&gt;</span>jar<span class="nt">&lt;/packaging&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;name&gt;</span>sparkblog<span class="nt">&lt;/name&gt;</span>
</span><span class='line'><span class="nt">&lt;url&gt;&lt;a</span> <span class="na">href=</span><span class="s">&quot;http://maven.apache.org&quot;</span><span class="nt">&gt;</span>http://maven.apache.org<span class="nt">&lt;/a&gt;&lt;/url&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;properties&gt;</span>
</span><span class='line'>  <span class="ni">&amp;lt;</span>project.build.sourceEncoding&gt;UTF-8<span class="ni">&amp;lt;</span>/project.build.sourceEncoding&gt;
</span><span class='line'><span class="nt">&lt;/properties&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;dependencies&gt;</span>
</span><span class='line'>  <span class="nt">&lt;dependency&gt;</span>
</span><span class='line'>    <span class="nt">&lt;groupId&gt;</span>com.sparkjava<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;artifactId&gt;</span>spark-core<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>    <span class="nt">&lt;version&gt;</span>2.1<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/dependency&gt;</span>
</span><span class='line'><span class="nt">&lt;/dependencies&gt;&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="nt">&lt;p&gt;&lt;build&gt;</span>
</span><span class='line'>  <span class="nt">&lt;plugins&gt;</span>
</span><span class='line'>    <span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>      <span class="nt">&lt;groupId&gt;</span>org.apache.maven.plugins<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>      <span class="nt">&lt;artifactId&gt;</span>maven-compiler-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>      <span class="nt">&lt;version&gt;</span>3.1<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>      <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>        <span class="nt">&lt;target&gt;</span>1.8<span class="nt">&lt;/target&gt;</span>
</span><span class='line'>        <span class="nt">&lt;source&gt;</span>1.8<span class="nt">&lt;/source&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/plugin&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/plugins&gt;</span>
</span><span class='line'><span class="nt">&lt;/build&gt;</span>
</span><span class='line'><span class="nt">&lt;/project&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p></li>
</ul>


<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">halyph</span><span class="o">.</span><span class="na">blog</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kn">import</span> <span class="nn">static</span> <span class="n">spark</span><span class="o">.</span><span class="na">Spark</span><span class="o">.</span><span class="na">get</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">NumberFormatException</span> <span class="o">{&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span>    <span class="n">String</span> <span class="n">myArgs</span> <span class="o">=</span> <span class="s">&quot;&quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="n">String</span> <span class="n">arg</span> <span class="o">:</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">printf</span><span class="o">(</span><span class="s">&quot;&amp;gt; %s&quot;</span><span class="o">,</span> <span class="n">arg</span><span class="o">);</span>
</span><span class='line'>        <span class="n">myArgs</span> <span class="o">+=</span> <span class="n">arg</span> <span class="o">+</span> <span class="s">&quot; : &quot;</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">();</span>
</span><span class='line'>    <span class="kd">final</span> <span class="n">String</span> <span class="n">finalMyArgs</span> <span class="o">=</span> <span class="n">myArgs</span><span class="o">;</span>
</span><span class='line'>    <span class="n">get</span><span class="o">(</span><span class="s">&quot;/hello&quot;</span><span class="o">,</span> <span class="o">(</span><span class="n">request</span><span class="o">,</span> <span class="n">response</span><span class="o">)</span> <span class="o">-&amp;</span><span class="n">gt</span><span class="o">;</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="s">&quot;Hello World!\n args = &quot;</span> <span class="o">+</span> <span class="n">finalMyArgs</span><span class="o">;</span>
</span><span class='line'>    <span class="o">});</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
This application can be easily run via IDE, but lets run it via Maven</p>

<ul>
<li>We should use <a href="http://mojo.codehaus.org/exec-maven-plugin/usage.html">Exec Maven Plugin</a> to run the app with all dependencies
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mvn clean compile <span class="nb">exec</span>:java -Dexec.mainClass<span class="o">=</span><span class="p">&amp;</span>ldquo<span class="p">;</span>com.halyph.blog.App<span class="p">&amp;</span>rdquo<span class="p">;</span>  -Dexec.args<span class="o">=</span><span class="p">&amp;</span>ldquo<span class="p">;</span><span class="m">9090</span> one <span class="m">1</span> 2<span class="p">&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Scanning <span class="k">for</span> projects<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> <span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Building sparkblog 1.0-SNAPSHOT
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> <span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> <span class="p">&amp;</span>mdash<span class="p">;</span> maven-clean-plugin:2.4.1:clean <span class="o">(</span>default-clean<span class="o">)</span> @ sparkblog <span class="p">&amp;</span>mdash<span class="p">;</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Deleting d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> <span class="p">&amp;</span>mdash<span class="p">;</span> maven-resources-plugin:2.5:resources <span class="o">(</span>default-resources<span class="o">)</span> @ sparkblog <span class="p">&amp;</span>mdash<span class="p">;</span>
</span><span class='line'><span class="o">[</span>debug<span class="o">]</span> execute contextualize
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Using <span class="p">&amp;</span>lsquo<span class="p">;</span>UTF-8<span class="p">&amp;</span>rsquo<span class="p">;</span> encoding to copy filtered resources.
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> skip non existing resourceDirectory d:<span class="se">\M</span>yProjects<span class="se">\s</span>parkblog<span class="se">\s</span>rc<span class="se">\m</span>ain<span class="se">\r</span>esources
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> <span class="p">&amp;</span>mdash<span class="p">;</span> maven-compiler-plugin:3.1:compile <span class="o">(</span>default-compile<span class="o">)</span> @ sparkblog <span class="p">&amp;</span>mdash<span class="p">;</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Changes detected - recompiling the module!
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Compiling <span class="m">1</span> <span class="nb">source </span>file to d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget<span class="se">\c</span>lasses
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> &gt;&gt;&gt; <span class="nb">exec</span>-maven-plugin:1.2.1:java <span class="o">(</span>default-cli<span class="o">)</span> @ sparkblog &gt;&gt;&gt;
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> <span class="p">&amp;</span>lt<span class="p">;&amp;</span>lt<span class="p">;&amp;</span>lt<span class="p">;</span> <span class="nb">exec</span>-maven-plugin:1.2.1:java <span class="o">(</span>default-cli<span class="o">)</span> @ sparkblog <span class="p">&amp;</span>lt<span class="p">;&amp;</span>lt<span class="p">;&amp;</span>lt<span class="p">;</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> <span class="p">&amp;</span>mdash<span class="p">;</span> <span class="nb">exec</span>-maven-plugin:1.2.1:java <span class="o">(</span>default-cli<span class="o">)</span> @ sparkblog <span class="p">&amp;</span>mdash<span class="p">;</span>
</span><span class='line'>
</span><span class='line'>&lt;blockquote&gt;&lt;p&gt;9090&gt; one&gt; 1&gt; 2
</span><span class='line'><span class="o">[</span>Thread-1<span class="o">]</span> INFO spark.webserver.SparkServer - <span class="o">==</span> Spark has ignited <span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>Thread-1<span class="o">]</span> INFO spark.webserver.SparkServer - &gt;&gt; Listening on 0.0.0.0:4567
</span><span class='line'><span class="o">[</span>Thread-1<span class="o">]</span> INFO org.eclipse.jetty.server.Server - jetty-9.0.2.v20130417
</span><span class='line'><span class="o">[</span>Thread-1<span class="o">]</span> INFO org.eclipse.jetty.server.ServerConnector - Started ServerConnector@4afe75c9<span class="o">{</span>HTTP/1.1<span class="o">}{</span>0.0.0.0:4567<span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p></blockquote></li>
</ul>


<p>In case the application run configurations is persistent (&ldquo;main&rdquo; class and CLI arguments are changing rarely) we can configure it in <strong>pom.xml</strong>:
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'> <span class="nt">&lt;build&gt;</span>
</span><span class='line'>    <span class="nt">&lt;plugins&gt;</span>
</span><span class='line'>      <span class="ni">&amp;hellip;</span>
</span><span class='line'>      <span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>        <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;artifactId&gt;</span>exec-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>        <span class="nt">&lt;version&gt;</span>1.3.2<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>        <span class="nt">&lt;executions&gt;</span>
</span><span class='line'>          <span class="nt">&lt;execution&gt;</span>
</span><span class='line'>            <span class="nt">&lt;goals&gt;</span>
</span><span class='line'>              <span class="nt">&lt;goal&gt;</span>java<span class="nt">&lt;/goal&gt;</span>
</span><span class='line'>            <span class="nt">&lt;/goals&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/execution&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/executions&gt;</span>
</span><span class='line'>        <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>          <span class="nt">&lt;mainClass&gt;</span>com.halyph.blog.App<span class="nt">&lt;/mainClass&gt;</span>
</span><span class='line'>          <span class="nt">&lt;arguments&gt;</span>
</span><span class='line'>            <span class="nt">&lt;argument&gt;</span>9090<span class="nt">&lt;/argument&gt;</span>
</span><span class='line'>            <span class="nt">&lt;argument&gt;</span>one<span class="nt">&lt;/argument&gt;</span>
</span><span class='line'>            <span class="nt">&lt;argument&gt;</span>1<span class="nt">&lt;/argument&gt;</span>
</span><span class='line'>            <span class="nt">&lt;argument&gt;</span>2<span class="nt">&lt;/argument&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/arguments&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/plugin&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/plugins&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/build&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<ul>
<li>It&rsquo;s nice idea to use <code>mvn exec:java</code>, but it might be a little bit slow. So, we might decide to use some shell script which increase compiled application ramp up time. The problem is that the application have dependencies (which have transitive dependencies). I.e. <code>java</code> classpath have to be configured somehow.</li>
</ul>


<p>Well, I borrowed the ideas from &ldquo;<a href="http://saltnlight5.blogspot.com/2012/08/a-better-java-shell-script-wrapper.html">A better java shell script wrapper</a>&rdquo; script. Here it is:
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
<span class='line-number'>84</span>
<span class='line-number'>85</span>
<span class='line-number'>86</span>
<span class='line-number'>87</span>
<span class='line-number'>88</span>
<span class='line-number'>89</span>
<span class='line-number'>90</span>
<span class='line-number'>91</span>
<span class='line-number'>92</span>
<span class='line-number'>93</span>
<span class='line-number'>94</span>
<span class='line-number'>95</span>
<span class='line-number'>96</span>
<span class='line-number'>97</span>
<span class='line-number'>98</span>
<span class='line-number'>99</span>
<span class='line-number'>100</span>
<span class='line-number'>101</span>
<span class='line-number'>102</span>
<span class='line-number'>103</span>
<span class='line-number'>104</span>
<span class='line-number'>105</span>
<span class='line-number'>106</span>
<span class='line-number'>107</span>
<span class='line-number'>108</span>
<span class='line-number'>109</span>
<span class='line-number'>110</span>
<span class='line-number'>111</span>
<span class='line-number'>112</span>
<span class='line-number'>113</span>
<span class='line-number'>114</span>
<span class='line-number'>115</span>
<span class='line-number'>116</span>
<span class='line-number'>117</span>
<span class='line-number'>118</span>
<span class='line-number'>119</span>
<span class='line-number'>120</span>
<span class='line-number'>121</span>
<span class='line-number'>122</span>
<span class='line-number'>123</span>
<span class='line-number'>124</span>
<span class='line-number'>125</span>
<span class='line-number'>126</span>
<span class='line-number'>127</span>
<span class='line-number'>128</span>
<span class='line-number'>129</span>
<span class='line-number'>130</span>
<span class='line-number'>131</span>
<span class='line-number'>132</span>
<span class='line-number'>133</span>
<span class='line-number'>134</span>
<span class='line-number'>135</span>
<span class='line-number'>136</span>
<span class='line-number'>137</span>
<span class='line-number'>138</span>
<span class='line-number'>139</span>
<span class='line-number'>140</span>
<span class='line-number'>141</span>
<span class='line-number'>142</span>
<span class='line-number'>143</span>
<span class='line-number'>144</span>
<span class='line-number'>145</span>
<span class='line-number'>146</span>
<span class='line-number'>147</span>
<span class='line-number'>148</span>
<span class='line-number'>149</span>
<span class='line-number'>150</span>
<span class='line-number'>151</span>
<span class='line-number'>152</span>
<span class='line-number'>153</span>
<span class='line-number'>154</span>
<span class='line-number'>155</span>
<span class='line-number'>156</span>
<span class='line-number'>157</span>
<span class='line-number'>158</span>
<span class='line-number'>159</span>
<span class='line-number'>160</span>
<span class='line-number'>161</span>
<span class='line-number'>162</span>
<span class='line-number'>163</span>
<span class='line-number'>164</span>
<span class='line-number'>165</span>
<span class='line-number'>166</span>
<span class='line-number'>167</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;!/usr/bin/env bash&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Copyright <span class="m">2012</span> Zemian Deng&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;A wrapper script that run any Java application in unix/cygwin bash env.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;This script is assumed to be located in an application<span class="p">&amp;</span>rsquo<span class="p">;</span>s <span class="p">&amp;</span>ldquo<span class="p">;</span>bin<span class="p">&amp;</span>rdquo<span class="p">;</span> directory. It will&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;auto resolve its directory location relative to the application path <span class="o">(</span>which is one&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;parent up from the script.<span class="o">)</span> Therefore, this script can be run any where in the file&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;system and it will still reference the same application directory.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;This script will by default auto setup a Java classpath that picks up any <span class="p">&amp;</span>ldquo<span class="p">;</span>config<span class="p">&amp;</span>rdquo<span class="p">;</span>&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;and <span class="p">&amp;</span>ldquo<span class="p">;</span>lib<span class="p">&amp;</span>rdquo<span class="p">;</span> directories under the application directory. It also will also add a&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;any typical Maven project output directories such as <span class="p">&amp;</span>ldquo<span class="p">;</span>target/test-classes<span class="p">&amp;</span>rdquo<span class="p">;</span>,&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;<span class="p">&amp;</span>ldquo<span class="p">;</span>target/classes<span class="p">&amp;</span>rdquo<span class="p">;</span>, and <span class="p">&amp;</span>ldquo<span class="p">;</span>target/dependency<span class="p">&amp;</span>rdquo<span class="p">;</span> into classpath. This can be disable by&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;setting <span class="nv">RUN_JAVA_NO_AUTOCP</span><span class="o">=</span>1.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;If the <span class="p">&amp;</span>ldquo<span class="p">;</span>Default parameters<span class="p">&amp;</span>rdquo<span class="p">;</span> section bellow doesn<span class="p">&amp;</span>rsquo<span class="p">;</span>t match to user<span class="p">&amp;</span>rsquo<span class="p">;</span>s env, <span class="k">then</span> user&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;may override these variables in their terminal session or preset them in shell<span class="p">&amp;</span>rsquo<span class="p">;</span>s&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;profile startup script. The values of all path should be in cygwin/unix path,&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;and this script will auto convert them into Windows path where is needed.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;User may customize the Java classpath by setting RUN_JAVA_CP, which will prefix to existing&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;classpath, or use the <span class="p">&amp;</span>ldquo<span class="p">;</span>-cp<span class="p">&amp;</span>rdquo<span class="p">;</span> option, which will postfix to existing classpath.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Usage:&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;run-java <span class="o">[</span>java_opts<span class="o">]</span> &lt;java_main_class&gt; <span class="o">[</span>-cp /more/classpath<span class="o">]</span> <span class="o">[</span>-Dsysprop<span class="o">=</span>value<span class="o">]</span>&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Example:&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;run-java example.Hello&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;run-java example.Hello -Dname<span class="o">=</span>World&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;run-java org.junit.runner.JUnitCore example.HelloTest -cp <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$HOME</span>/apps/junit/lib/*<span class="p">&amp;</span>rdquo<span class="p">;</span>&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Created by: Zemian Deng 03/09/2012&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;This run script dir <span class="o">(</span>resolve to absolute path<span class="o">)</span>&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;SCRIPT_DIR<span class="o">=</span><span class="k">$(</span><span class="nb">cd</span> <span class="k">$(</span>dirname <span class="nv">$0</span><span class="k">)</span> <span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> <span class="nb">pwd</span><span class="k">)</span>    <span class="c"># This dir is where this script live.</span>
</span><span class='line'><span class="nv">APP_DIR</span><span class="o">=</span><span class="k">$(</span><span class="nb">cd</span> <span class="nv">$SCRIPT_DIR</span>/.. <span class="p">&amp;</span>amp<span class="p">;&amp;</span>amp<span class="p">;</span> <span class="nb">pwd</span><span class="k">)</span>      <span class="c"># Assume the application dir is one level up from script dir.&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Default parameters&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;JAVA_HOME<span class="o">=</span><span class="k">${</span><span class="nv">JAVA_HOME</span><span class="p">:=</span><span class="nv">$HOME</span><span class="p">/apps/jdk</span><span class="k">}</span>     <span class="c"># This is the home directory of Java development kit.</span>
</span><span class='line'><span class="nv">RUN_JAVA_CP</span><span class="o">=</span><span class="k">${</span><span class="nv">RUN_JAVA_CP</span><span class="p">:=</span><span class="nv">$CLASSPATH</span><span class="k">}</span>     <span class="c"># A classpath prefix before -classpath option, default to $CLASSPATH</span>
</span><span class='line'><span class="nv">RUN_JAVA_OPTS</span><span class="o">=</span><span class="k">${</span><span class="nv">RUN_JAVA_OPTS</span><span class="p">:=</span><span class="k">}</span>           <span class="c"># Java options (-Xmx512m -XX:MaxPermSize=128m etc)</span>
</span><span class='line'><span class="nv">RUN_JAVA_DEBUG</span><span class="o">=</span><span class="k">${</span><span class="nv">RUN_JAVA_DEBUG</span><span class="p">:=</span><span class="k">}</span>         <span class="c"># If not empty, print the full java command line before executing it.</span>
</span><span class='line'><span class="nv">RUN_JAVA_NO_PARSE</span><span class="o">=</span><span class="k">${</span><span class="nv">RUN_JAVA_NO_PARSE</span><span class="p">:=</span><span class="k">}</span>   <span class="c"># If not empty, skip the auto parsing of -D and -cp options from script arguments.</span>
</span><span class='line'><span class="nv">RUN_JAVA_NO_AUTOCP</span><span class="o">=</span><span class="k">${</span><span class="nv">RUN_JAVA_NO_AUTOCP</span><span class="p">:=</span><span class="k">}</span> <span class="c"># If not empty, do not auto setup Java classpath</span>
</span><span class='line'><span class="nv">RUN_JAVA_DRY</span><span class="o">=</span><span class="k">${</span><span class="nv">RUN_JAVA_DRY</span><span class="p">:=</span><span class="k">}</span>             <span class="c"># If not empty, do not exec Java command, but just print&lt;/p&gt;</span>
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;OS specific support.  <span class="nv">$var</span> &lt;em&gt;must&lt;/em&gt; be <span class="nb">set </span>to either <span class="nb">true </span>or false.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;CYGWIN<span class="o">=</span><span class="nb">false</span><span class="p">;</span>
</span><span class='line'><span class="k">case</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>&lt;code&gt;uname&lt;/code&gt;<span class="p">&amp;</span>rdquo<span class="p">;</span> in
</span><span class='line'>  CYGWIN*<span class="o">)</span> <span class="nv">CYGWIN</span><span class="o">=</span><span class="nb">true</span> <span class="p">;;</span>
</span><span class='line'><span class="k">esac</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Define where is the java executable is&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;JAVA_CMD<span class="o">=</span>java
</span><span class='line'><span class="k">if</span> <span class="o">[</span> -d <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$JAVA_HOME</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="nv">JAVA_CMD</span><span class="o">=</span><span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$JAVA_HOME</span>/bin/java<span class="p">&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'><span class="k">fi</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Auto setup applciation<span class="p">&amp;</span>rsquo<span class="p">;</span>s Java Classpath <span class="o">(</span>only <span class="k">if</span> they exists<span class="o">)</span>&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;if <span class="o">[</span> -z <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$RUN_JAVA_NO_AUTOCP</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">[</span> -d <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$APP_DIR</span>/config<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nv">RUN_JAVA_CP</span><span class="o">=</span><span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$RUN_JAVA_CP</span>:<span class="nv">$APP_DIR</span>/config<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="p">;</span> <span class="k">fi</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">[</span> -d <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$APP_DIR</span>/target/test-classes<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nv">RUN_JAVA_CP</span><span class="o">=</span><span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$RUN_JAVA_CP</span>:<span class="nv">$APP_DIR</span>/target/test-classes<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="p">;</span> <span class="k">fi</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">[</span> -d <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$APP_DIR</span>/target/classes<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nv">RUN_JAVA_CP</span><span class="o">=</span><span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$RUN_JAVA_CP</span>:<span class="nv">$APP_DIR</span>/target/classes<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="p">;</span> <span class="k">fi</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">[</span> -d <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$APP_DIR</span>/target/dependency<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nv">RUN_JAVA_CP</span><span class="o">=</span><span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$RUN_JAVA_CP</span>:<span class="nv">$APP_DIR</span>/target/dependency/&lt;em&gt;<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="p">;</span> <span class="k">fi</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">[</span> -d <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$APP_DIR</span>/lib<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span> <span class="nv">RUN_JAVA_CP</span><span class="o">=</span><span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$RUN_JAVA_CP</span>:<span class="nv">$APP_DIR</span>/lib/&lt;/em&gt;<span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="p">;</span> <span class="k">fi</span>
</span><span class='line'><span class="k">fi</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;ARGS<span class="o">=</span><span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$@</span><span class="p">&amp;</span>rdquo<span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Parse addition <span class="p">&amp;</span>ldquo<span class="p">;</span>-cp<span class="p">&amp;</span>rdquo<span class="p">;</span> and <span class="p">&amp;</span>ldquo<span class="p">;</span>-D<span class="p">&amp;</span>rdquo<span class="p">;</span> after the Java main class from script arguments&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;This is <span class="k">done</span> <span class="k">for</span> convenient sake so users <span class="k">do</span> not have to <span class="nb">export </span>RUN_JAVA_CP and RUN_JAVA_OPTS&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;saparately, but now they can pass into end of this run-java script instead.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;This can be disable by setting <span class="nv">RUN_JAVA_NO_PARSE</span><span class="o">=</span>1.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;if <span class="o">[</span> -z <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$RUN_JAVA_NO_PARSE</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="c"># Prepare variables for parsing</span>
</span><span class='line'>    <span class="nv">FOUND_CP</span><span class="o">=</span>
</span><span class='line'>    NEW_ARGS<span class="o">[</span>0<span class="o">]=</span><span class="p">&amp;</span>lsquo<span class="p">;&amp;</span>rsquo<span class="p">;</span>
</span><span class='line'>    <span class="nv">IDX</span><span class="o">=</span>0&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;# Parse all arguments and look <span class="k">for</span> <span class="s2">&quot;-cp&quot;</span> and <span class="s2">&quot;-D&quot;</span>
</span><span class='line'><span class="k">for</span> ARG in <span class="s2">&quot;$@&quot;</span><span class="p">;</span> <span class="k">do</span>
</span><span class='line'>    <span class="k">if</span> <span class="o">[[</span> -n <span class="nv">$FOUND_CP</span> <span class="o">]]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>        <span class="nv">RUN_JAVA_CP</span><span class="o">=</span><span class="s2">&quot;$RUN_JAVA_CP:$ARG&quot;</span>
</span><span class='line'>        <span class="nv">FOUND_CP</span><span class="o">=</span>
</span><span class='line'>    <span class="k">else</span>
</span><span class='line'>        <span class="k">case</span> <span class="nv">$ARG</span> in
</span><span class='line'>        <span class="s1">&#39;-cp&#39;</span><span class="o">)</span>
</span><span class='line'>            <span class="nv">FOUND_CP</span><span class="o">=</span>1
</span><span class='line'>            <span class="p">;;</span>
</span><span class='line'>        <span class="s1">&#39;-D&#39;</span>*<span class="o">)</span>
</span><span class='line'>            <span class="nv">RUN_JAVA_OPTS</span><span class="o">=</span><span class="s2">&quot;$RUN_JAVA_OPTS $ARG&quot;</span>
</span><span class='line'>            <span class="p">;;</span>
</span><span class='line'>        *<span class="o">)</span>
</span><span class='line'>            NEW_ARGS<span class="o">[</span><span class="nv">$IDX</span><span class="o">]=</span><span class="s2">&quot;$ARG&quot;</span>
</span><span class='line'>            <span class="nb">let </span><span class="nv">IDX</span><span class="o">=</span><span class="nv">$IDX</span>+1
</span><span class='line'>            <span class="p">;;</span>
</span><span class='line'>        <span class="k">esac</span>
</span><span class='line'>    <span class="k">fi</span>
</span><span class='line'><span class="k">done</span>
</span><span class='line'><span class="nv">ARGS</span><span class="o">=</span><span class="s2">&quot;${NEW_ARGS[@]}&quot;</span>
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;fi&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Convert Windows Java Classpath&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;if <span class="nv">$CYGWIN</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="nv">RUN_JAVA_CP</span><span class="o">=</span><span class="k">$(</span>cygpath -mp <span class="nv">$RUN_JAVA_CP</span><span class="k">)</span>
</span><span class='line'><span class="k">fi</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Display full Java command.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;if <span class="o">[</span> -n <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$RUN_JAVA_DEBUG</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">]</span> <span class="o">||</span> <span class="o">[</span> -n <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$RUN_JAVA_DRY</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$JAVA_CMD</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="nv">$RUN_JAVA_OPTS</span> -cp <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$RUN_JAVA_CP</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="nv">$ARGS</span>
</span><span class='line'><span class="k">fi</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Run Java Main class&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;if <span class="o">[</span> -z <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$RUN_JAVA_DRY</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$JAVA_CMD</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="nv">$RUN_JAVA_OPTS</span> -cp <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$RUN_JAVA_CP</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="nv">$ARGS</span>
</span><span class='line'><span class="k">fi</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>The main idea is to run <code>mvn dependency:copy-dependencies</code>, this will generate all the jar files into <code>target/dependency</code> folder</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'><span class="nv">$ </span>mvn dependency:copy-dependencies
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Scanning <span class="k">for</span> projects<span class="p">&amp;</span>hellip<span class="p">;</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> <span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Building sparkblog 1.0-SNAPSHOT
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> <span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> <span class="p">&amp;</span>mdash<span class="p">;</span> maven-dependency-plugin:2.1:copy-dependencies <span class="o">(</span>default-cli<span class="o">)</span> @ sparkblog <span class="p">&amp;</span>mdash<span class="p">;</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Copying spark-core-2.1.jar to d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget<span class="se">\d</span>ependency<span class="se">\s</span>park-core-2.1.jar
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Copying jetty-http-9.0.2.v20130417.jar to d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget<span class="se">\d</span>ependency<span class="se">\j</span>etty-http-9.0.2.v20130417.jar
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Copying jetty-io-9.0.2.v20130417.jar to d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget<span class="se">\d</span>ependency<span class="se">\j</span>etty-io-9.0.2.v20130417.jar
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Copying jetty-security-9.0.2.v20130417.jar to d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget<span class="se">\d</span>ependency<span class="se">\j</span>etty-security-9.0.2.v20130417.jar
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Copying jetty-server-9.0.2.v20130417.jar to d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget<span class="se">\d</span>ependency<span class="se">\j</span>etty-server-9.0.2.v20130417.jar
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Copying jetty-servlet-9.0.2.v20130417.jar to d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget<span class="se">\d</span>ependency<span class="se">\j</span>etty-servlet-9.0.2.v20130417.jar
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Copying jetty-util-9.0.2.v20130417.jar to d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget<span class="se">\d</span>ependency<span class="se">\j</span>etty-util-9.0.2.v20130417.jar
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Copying jetty-webapp-9.0.2.v20130417.jar to d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget<span class="se">\d</span>ependency<span class="se">\j</span>etty-webapp-9.0.2.v20130417.jar
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Copying jetty-xml-9.0.2.v20130417.jar to d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget<span class="se">\d</span>ependency<span class="se">\j</span>etty-xml-9.0.2.v20130417.jar
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Copying javax.servlet-3.0.0.v201112011016.jar to d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget<span class="se">\d</span>ependency<span class="se">\j</span>avax.servlet-3.0.0.v201112011016.jar
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Copying slf4j-api-1.7.7.jar to d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget<span class="se">\d</span>ependency<span class="se">\s</span>lf4j-api-1.7.7.jar
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Copying slf4j-simple-1.7.7.jar to d:<span class="se">\M</span>yProjects<span class="se">\j</span>wrapper<span class="se">\b</span>loggg<span class="se">\s</span>parkblog<span class="se">\t</span>arget<span class="se">\d</span>ependency<span class="se">\s</span>lf4j-simple-1.7.7.jar
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> <span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> BUILD SUCCESS
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> <span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Total <span class="nb">time</span>: 2.978s
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Finished at: Thu Feb <span class="m">12</span> 18:22:54 EET 2015
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> Final Memory: 9M/243M
</span><span class='line'><span class="o">[</span>INFO<span class="o">]</span> <span class="p">&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;&amp;</span>mdash<span class="p">;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
Now, we can reuse the provided <em>above</em> script <strong>or</strong> use the provided <em>below</em> one-liner:
<code>
java -cp target\classes;target\dependency\* com.halyph.blog.App 9090 one 1 2
</code>
This one-liner is very simple and can be transformed to shell/batch scripts depending on the level of re-use you&rsquo;d like to implement.</p>

<ul>
<li>Now, it&rsquo;s time to created pre-packed application bundle which can be easily distributed. We will use <a href="http://mojo.codehaus.org/appassembler/appassembler-maven-plugin/usage-program.html">Maven Application Assembler Plugin</a>:
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
</pre></td><td class='code'><pre><code class='xml'><span class='line'><span class="nt">&lt;build&gt;</span>
</span><span class='line'>  <span class="nt">&lt;plugins&gt;</span>
</span><span class='line'>   <span class="ni">&amp;hellip;</span>
</span><span class='line'>    <span class="nt">&lt;plugin&gt;</span>
</span><span class='line'>      <span class="nt">&lt;groupId&gt;</span>org.codehaus.mojo<span class="nt">&lt;/groupId&gt;</span>
</span><span class='line'>      <span class="nt">&lt;artifactId&gt;</span>appassembler-maven-plugin<span class="nt">&lt;/artifactId&gt;</span>
</span><span class='line'>      <span class="nt">&lt;version&gt;</span>1.9<span class="nt">&lt;/version&gt;</span>
</span><span class='line'>      <span class="c">&lt;!--</span>
</span><span class='line'><span class="c">      This (executions) section can be omitted.</span>
</span><span class='line'><span class="c">      In case it&#39;s omitted we should call the next command to generate wrapper:</span>
</span><span class='line'><span class="c">      mvn package appassembler:assemble</span>
</span><span class='line'><span class="c">      --&gt;</span>
</span><span class='line'>      <span class="nt">&lt;executions&gt;</span>
</span><span class='line'>        <span class="nt">&lt;execution&gt;</span>
</span><span class='line'>          <span class="nt">&lt;phase&gt;</span>package<span class="nt">&lt;/phase&gt;</span>
</span><span class='line'>          <span class="nt">&lt;goals&gt;</span>
</span><span class='line'>            <span class="nt">&lt;goal&gt;</span>assemble<span class="nt">&lt;/goal&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/goals&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/execution&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/executions&gt;</span>
</span><span class='line'>      <span class="nt">&lt;configuration&gt;</span>
</span><span class='line'>        <span class="nt">&lt;programs&gt;</span>
</span><span class='line'>          <span class="nt">&lt;program&gt;</span>
</span><span class='line'>            <span class="nt">&lt;mainClass&gt;</span>com.halyph.blog.App<span class="nt">&lt;/mainClass&gt;</span>
</span><span class='line'>            <span class="nt">&lt;id&gt;</span>app<span class="nt">&lt;/id&gt;</span>
</span><span class='line'>          <span class="nt">&lt;/program&gt;</span>
</span><span class='line'>        <span class="nt">&lt;/programs&gt;</span>
</span><span class='line'>      <span class="nt">&lt;/configuration&gt;</span>
</span><span class='line'>    <span class="nt">&lt;/plugin&gt;</span>
</span><span class='line'>  <span class="nt">&lt;/plugins&gt;</span>
</span><span class='line'><span class="nt">&lt;/build&gt;</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>

<blockquote><p>The Application Assembler Plugin is a Maven plugin for generating scripts for starting java applications. All dependencies and the artifact of the project itself are placed in a generated Maven repository in a defined assemble directory. All artifacts (dependencies + the artifact from the project) are added to the classpath in the generated bin scripts.</p></blockquote></li>
</ul>


<p><a href="http://mojo.codehaus.org/appassembler/appassembler-maven-plugin/usage-program.html">Maven Application Assembler Plugin</a> usage:
<code>
$ mvn package
$ target/appassembler/bin/app
</code></p>

<blockquote><ul>
<li><p>All dependencies and the artifact itself are placed in the defined assemble directory (defaults to <code>$project.build.directory/appassembler</code>).</p></li>
<li><p>A <code>bin/</code> directory is created in the assemble directory and the generated bin scripts are placed in that directory (defaults to both unix shell scripts and Windows bat files).</p></li>
</ul>
</blockquote>

<p>Note: <a href="http://mojo.codehaus.org/appassembler/appassembler-maven-plugin/usage-program.html">Maven Application Assembler Plugin</a> have a lot of customization options, just check the documentation.</p>

<h2>Summary</h2>

<p>Here was shown that using such tool as Maven you can be productive and &ldquo;agile&rdquo; (use <a href="http://gradle.org">Gradle</a> if you&rsquo;d like to be in trend):</p>

<ul>
<li>generate project skeleton from scratch</li>
<li>open it in IDE without ceremony</li>
<li>call the app via Maven plugin</li>
<li>call it as plain CLI application, but with small ceremony (need to run <em>dependency:copy-dependencies</em>)</li>
<li>package the app for further distribution</li>
</ul>


<p>Yes, it&rsquo;s not a simple <em>write-one</em> Java &ldquo;script&rdquo;, but it&rsquo;s flexible enough to feel like it is.</p>

<h2>References</h2>

<ul>
<li><a href="/blog/2015/02/13/do-we-need-java-for-everything">Do We Need Java for Everything?</a></li>
<li><a href="http://saltnlight5.blogspot.com/2012/08/a-better-java-shell-script-wrapper.html">A better java shell script wrapper</a></li>
<li><a href="http://mojo.codehaus.org/exec-maven-plugin/usage.html">Exec Maven Plugin</a></li>
<li><a href="http://mojo.codehaus.org/appassembler/appassembler-maven-plugin/usage-program.html">Maven Application Assembler Plugin</a></li>
<li><a href="http://blog.plesslweb.ch/post/6628462331/wrapper-script-for-java-command-line-applications">Wrapper Script for Java Command-Line Applications</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[Do We Need Java for Everything?]]></title>
    <link href="http://halyph.com/blog/2015/02/13/do-we-need-java-for-everything/"/>
    <updated>2015-02-13T00:18:30+02:00</updated>
    <id>http://halyph.com/blog/2015/02/13/do-we-need-java-for-everything</id>
    <content type="html"><![CDATA[<p><img class="center" src="/images/blog/java.png"></p>

<p>Some time ago one guy wrote a post <a href="http://www.teamten.com/lawrence/writings/java-for-everything.html">Java for Everything</a>. The main idea is to use Java even for shell scripting.</p>

<blockquote><p>I’m even taking this to an extreme and using Java for shell scripts. I’ve found that anything other than a simple wrapper shell script eventually grows to the point where I’m looking up the arcane syntax for removing some middle element from an array in bash &hellip; Write it in Java to start with. If shelling out to run commands is clumsy, write a utility function to make it easy.
I’ve also written a <em>java_launcher</em> shell script that allows me to write this at the top of Java programs:
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;!/usr/bin/env java_launcher&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;vim:ft<span class="o">=</span>java&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;lib:/home/lk/lib/teamten.jar&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;
</span></code></pre></td></tr></table></div></figure></notextile></div>
I can make the Java programs executable and drop the .java extension. The script strips the header, compiles and caches the class file, and runs the result with the specified jars. It provides one of the big advantages of Python: the lack of build scripts for simple one-off programs.</p></blockquote>

<p>Here is the actual source of <a href="https://github.com/lkesteloot/java_launcher">java_launcher</a>:</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
<span class='line-number'>54</span>
<span class='line-number'>55</span>
<span class='line-number'>56</span>
<span class='line-number'>57</span>
<span class='line-number'>58</span>
<span class='line-number'>59</span>
<span class='line-number'>60</span>
<span class='line-number'>61</span>
<span class='line-number'>62</span>
<span class='line-number'>63</span>
<span class='line-number'>64</span>
<span class='line-number'>65</span>
<span class='line-number'>66</span>
<span class='line-number'>67</span>
<span class='line-number'>68</span>
<span class='line-number'>69</span>
<span class='line-number'>70</span>
<span class='line-number'>71</span>
<span class='line-number'>72</span>
<span class='line-number'>73</span>
<span class='line-number'>74</span>
<span class='line-number'>75</span>
<span class='line-number'>76</span>
<span class='line-number'>77</span>
<span class='line-number'>78</span>
<span class='line-number'>79</span>
<span class='line-number'>80</span>
<span class='line-number'>81</span>
<span class='line-number'>82</span>
<span class='line-number'>83</span>
</pre></td><td class='code'><pre><code class='bash'><span class='line'>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;!/bin/bash&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Put this script in your path and write the following line at the top of an&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;executable Java <span class="nb">source </span>program:&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;#!/usr/bin/env java_launcher&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;#&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Additional documentation here: &lt;a <span class="nv">href</span><span class="o">=</span><span class="s2">&quot;https://github.com/lkesteloot/java_launcher&quot;</span>&gt;https://github.com/lkesteloot/java_launcher&lt;/a&gt;&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Quit on error.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;set -e&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Get the name of the script, which the shell passes to us automatically.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;SOURCE_PATHNAME<span class="o">=</span><span class="nv">$1</span>
</span><span class='line'><span class="k">if</span> <span class="o">[</span> <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$SOURCE_PATHNAME</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">=</span> <span class="p">&amp;</span>ldquo<span class="p">;&amp;</span>rdquo<span class="p">;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="nb">echo</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>java_launcher: Must supply name of script as first argument.<span class="p">&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'>    <span class="nb">exit </span>1
</span><span class='line'><span class="k">fi</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Skip the script name.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;shift&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Compute the MD5 of both the <span class="nb">source </span>file and this script.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;if <span class="o">[</span> -f /sbin/md5 <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="c"># Mac OS/X.</span>
</span><span class='line'>    <span class="nv">SUM</span><span class="o">=</span><span class="k">$(</span>cat <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$SOURCE_PATHNAME</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="nv">$0</span> <span class="p">|</span> md5<span class="k">)</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>    <span class="c"># Linux.</span>
</span><span class='line'>    <span class="nv">SUM</span><span class="o">=</span><span class="k">$(</span>cat <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$SOURCE_PATHNAME</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="nv">$0</span> <span class="p">|</span> md5sum <span class="p">|</span> cut -d<span class="p">&amp;</span><span class="c">#8217; &amp;lsquo; -f1)</span>
</span><span class='line'><span class="k">fi</span>
</span><span class='line'><span class="nv">SOURCE_FILENAME</span><span class="o">=</span><span class="k">$(</span>basename <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$SOURCE_PATHNAME</span><span class="p">&amp;</span>rdquo<span class="p">;</span><span class="k">)</span>
</span><span class='line'><span class="nv">SOURCE_DIR</span><span class="o">=</span><span class="k">$(</span>dirname <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$SOURCE_PATHNAME</span><span class="p">&amp;</span>rdquo<span class="p">;</span><span class="k">)</span>
</span><span class='line'><span class="nv">CLASS_NAME</span><span class="o">=</span><span class="k">$(</span><span class="nb">echo</span> <span class="nv">$SOURCE_FILENAME</span> <span class="p">|</span> sed -e <span class="p">&amp;</span>rsquo<span class="p">;</span>s/.*//<span class="p">&amp;</span>rsquo<span class="p">;</span><span class="k">)</span>
</span><span class='line'><span class="nv">CACHE_DIR</span><span class="o">=</span><span class="nv">$HOME</span>/.java_launcher_cache
</span><span class='line'><span class="nv">CLASS_DIR</span><span class="o">=</span><span class="nv">$CACHE_DIR</span>/<span class="nv">$SUM</span>
</span><span class='line'><span class="nv">PROCESSED_SOURCE</span><span class="o">=</span><span class="nv">$CLASS_DIR</span>/<span class="k">${</span><span class="nv">SOURCE_FILENAME</span><span class="k">}</span>.java
</span><span class='line'><span class="nv">PROCESSED_CLASS</span><span class="o">=</span><span class="nv">$CLASS_DIR</span>/<span class="k">${</span><span class="nv">SOURCE_FILENAME</span><span class="k">}</span>.class&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Process <span class="nb">source </span>to find libs <span class="k">for</span> classpath. Relative jars are made relative to the&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;source file.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;export <span class="nv">CLASSPATH</span><span class="o">=</span><span class="k">$(</span>awk <span class="p">&amp;</span>lsquo<span class="p">;</span>BEGIN <span class="o">{</span> <span class="nv">CLASSPATH</span><span class="o">=</span><span class="p">&amp;</span>ldquo<span class="p">;&amp;</span>rdquo<span class="p">;</span> <span class="o">}</span> /^# lib:<span class="o">(</span>.*<span class="k">)</span><span class="nv">$/</span> <span class="o">{</span> <span class="nv">jar</span> <span class="o">=</span> substr<span class="o">(</span><span class="nv">$0</span>, 7<span class="k">)</span><span class="p">;</span> <span class="k">if</span> <span class="o">(</span>substr<span class="o">(</span>jar, 1, 1<span class="o">)</span> !<span class="o">=</span> <span class="p">&amp;</span>ldquo<span class="p">;</span>/<span class="p">&amp;</span>rdquo<span class="p">;</span><span class="o">)</span> <span class="nv">jar</span> <span class="o">=</span> SOURCE_DIR <span class="p">&amp;</span>ldquo<span class="p">;</span>/<span class="p">&amp;</span>rdquo<span class="p">;</span> jar<span class="p">;</span> <span class="k">if</span> <span class="o">(</span>CLASSPATH !<span class="o">=</span> <span class="p">&amp;</span>ldquo<span class="p">;&amp;</span>rdquo<span class="p">;</span><span class="o">)</span> <span class="nv">CLASSPATH</span> <span class="o">=</span> CLASSPATH <span class="p">&amp;</span>ldquo<span class="p">;</span>:<span class="p">&amp;</span>rdquo<span class="p">;;</span> <span class="nv">CLASSPATH</span> <span class="o">=</span> CLASSPATH jar <span class="o">}</span> END <span class="o">{</span> print CLASSPATH <span class="o">}</span><span class="p">&amp;</span>rsquo<span class="p">;</span> <span class="nv">SOURCE_DIR</span><span class="o">=</span><span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$SOURCE_DIR</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="p">&amp;</span>lt<span class="p">;</span> <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$SOURCE_PATHNAME</span><span class="p">&amp;</span>rdquo<span class="p">;</span><span class="o">)</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Default libraries. Put default ones last.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;SCRIPT_DIR<span class="o">=</span><span class="k">$(</span>dirname <span class="nv">$0</span><span class="k">)</span>
</span><span class='line'><span class="nv">LIB_DIR</span><span class="o">=</span><span class="nv">$SCRIPT_DIR</span>/java_lib
</span><span class='line'><span class="nb">export </span><span class="nv">CLASSPATH</span><span class="o">=</span><span class="nv">$CLASSPATH</span>:<span class="nv">$LIB_DIR</span>/*&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Compile <span class="k">if</span> necessary.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;if <span class="o">[</span> -f <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$PROCESSED_CLASS</span><span class="p">&amp;</span>rdquo<span class="p">;</span> <span class="o">]</span><span class="p">;</span> <span class="k">then</span>
</span><span class='line'>    <span class="c"># Refresh the dir so that we know we&amp;rsquo;ve used it recently.</span>
</span><span class='line'>    touch <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$CLASS_DIR</span><span class="p">&amp;</span>rdquo<span class="p">;</span>
</span><span class='line'><span class="k">else</span>
</span><span class='line'>    mkdir -p <span class="p">&amp;</span>ldquo<span class="p">;</span><span class="nv">$CLASS_DIR</span><span class="p">&amp;</span>rdquo<span class="p">;</span>&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;pre&gt;&lt;code&gt;# Remove header. That<span class="s1">&#39;s anything that starts with #. Replace the lines with</span>
</span><span class='line'><span class="s1"># an empty line so the line numbers don&#39;</span>t get thrown off.
</span><span class='line'>sed -e <span class="s1">&#39;s/^#.*//&#39;</span> <span class="p">&amp;</span>lt<span class="p">;</span> <span class="s2">&quot;$SOURCE_PATHNAME&quot;</span> <span class="p">&amp;</span>gt<span class="p">;</span> <span class="s2">&quot;$PROCESSED_SOURCE&quot;</span>
</span><span class='line'>
</span><span class='line'><span class="c"># Compile real source to our cache.</span>
</span><span class='line'>javac -d <span class="s2">&quot;$CLASS_DIR&quot;</span> <span class="s2">&quot;$PROCESSED_SOURCE&quot;</span>
</span><span class='line'>&lt;/code&gt;&lt;/pre&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;fi&lt;/p&gt;
</span><span class='line'>
</span><span class='line'>&lt;h1&gt;Run the program, passing on arguments from <span class="nb">command </span>line.&lt;/h1&gt;
</span><span class='line'>
</span><span class='line'>&lt;p&gt;export <span class="nv">CLASSPATH</span><span class="o">=</span><span class="nv">$CLASS_DIR</span>:<span class="nv">$CLASSPATH</span>
</span><span class='line'>java -Xmx1024m <span class="nv">$CLASS_NAME</span> <span class="nv">$*</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>And suppose we&rsquo;d like to run <strong>helloworld</strong> Java &ldquo;script&rdquo; using different jars located in default library location (<strong>java_lib/</strong>) and custom (<strong>/home/username/mylib1.jar</strong> and <strong>/home/username/mylib2.jar</strong>)</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;!/</span><span class="n">usr</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">env</span> <span class="n">java_launcher</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="nl">vim:</span><span class="n">ft</span><span class="o">=</span><span class="n">java</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">h1</span><span class="o">&gt;</span><span class="nl">lib:</span><span class="o">/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">mylib1</span><span class="o">.</span><span class="na">jar</span><span class="o">:/</span><span class="n">home</span><span class="o">/</span><span class="n">username</span><span class="o">/</span><span class="n">mylib2</span><span class="o">.</span><span class="na">jar</span><span class="o">&lt;/</span><span class="n">h1</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">helloworld</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(&amp;</span><span class="n">ldquo</span><span class="o">;</span><span class="n">Hello</span> <span class="n">world</span><span class="o">!&amp;</span><span class="n">rdquo</span><span class="o">;);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<p>It can be run like this: <code>$ ./helloworld</code></p>

<h3>So, how does java_launcher work?</h3>

<ol>
<li>This launcher script works on Linux/MacOSX only. We should have additional <strong>java_launcher.bat</strong> script for Windows (cygwin and msys are not native Windows solution).</li>
<li>It supports two types of CLASSPATH lib folders</li>
<li><em>default</em> <strong>$SCRIPT_DIR/java_lib</strong> located in the same folder where the actual Java script located</li>
<li><em>custom</em> libs, they should be listed at the head <strong>lib</strong> section of the script (see sample above). The script uses AWK to extract jars from <strong>lib</strong> section</li>
<li><strong>java_launcher</strong> uses MD5 hashing to track source changes and (re)compile the source script only when it has been changed. See MD5 calculated <code>SUM</code> variable above</li>
<li><em>launcher</em> has dedicated folder where it stores the processed and compiled script (based on MD5 hash changes). See the next variables: <code>CACHE_DIR</code>, <code>PROCESSED_SOURCE</code> and <code>PROCESSED_CLASS</code>.</li>
<li>Then it combines the <em>default</em> and <em>custom</em> libs in resulted CLASSPATH</li>
</ol>


<h3>Drawbacks</h3>

<p>I see the next drawbacks:
- libs should be distributed along with actual &ldquo;script&rdquo;. The common use case is to have minimal required script, which downloads all required dependencies by yourself
- launcher is not cross-platform
- Java script requires additional configuration to be opened/edited in IDE (project file, adjust all dependencies, etc.)
- it&rsquo;s very hard to edit Java code in plain editor (Java language is verbose). Scripting in Java without IDE might be real pain</p>

<h2>Why not Groovy?</h2>

<p>I don&rsquo;t think that Java is &ldquo;good&rdquo; language for scripting (see drawbacks above). Groovy is much better language with nice scripting capabilities. Every Groovy script might be treated like a Java code snippet (with some exceptions <a href="http://groovy.codehaus.org/Differences+from+Java">[1]</a> and <a href="http://groovy-lang.org/differences.html">[2]</a>). But, the most important is that Groovy has build-in <a href="http://groovy-lang.org/grape.html">Grape dependency manager</a>:</p>

<blockquote><p>Grape (The Groovy Adaptable Packaging Engine or Groovy Advanced Packaging Engine) is the infrastructure enabling the grab() calls in Groovy, a set of classes leveraging Ivy to allow for a repository driven module system for Groovy. This allows a developer to write a script with an essentially arbitrary library requirement, and ship just the script. Grape will, at runtime, download as needed and link the named libraries and all dependencies forming a transitive closure when the script is run from existing repositories such as JCenter, Ibiblio, Codehaus, and java.net.</p></blockquote>

<p>Sample usage:
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Grapes</span><span class="o">([</span>
</span><span class='line'>   <span class="nd">@Grab</span><span class="o">(</span><span class="n">group</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">commons</span><span class="o">-</span><span class="n">primitives</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="n">module</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">commons</span><span class="o">-</span><span class="n">primitives</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="n">version</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="mf">1.0</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;),</span>
</span><span class='line'>   <span class="nd">@Grab</span><span class="o">(</span><span class="n">group</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">org</span><span class="o">.</span><span class="na">ccil</span><span class="o">.</span><span class="na">cowan</span><span class="o">.</span><span class="na">tagsoup</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="n">module</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="n">tagsoup</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;,</span> <span class="n">version</span><span class="o">=&amp;</span><span class="n">lsquo</span><span class="o">;</span><span class="mf">0.9</span><span class="o">.</span><span class="mi">7</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;)])</span>
</span><span class='line'><span class="kd">class</span> <span class="nc">Example</span> <span class="o">{</span>
</span><span class='line'><span class="c1">// &amp;hellip;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<blockquote><p>One or more <code>groovy.lang.Grab</code> annotations can be added at any place that annotations are accepted to tell the compiler that this code relies on the specific library. This will have the effect of adding the library to the classloader of the groovy compiler. This annotation is detected and evaluated before any other resolution of classes in the script, so imported classes can be properly resolved by a @Grab annotation.</p></blockquote>

<p><strong>So, I have no idea why to reinvent the wheel.</strong> Use Groovy for scripting and Java for everything else.</p>

<h2>References</h2>

<ul>
<li><a href="http://www.teamten.com/lawrence/writings/java-for-everything.html">Java for Everything</a></li>
<li>Some reflections to the original post <a href="http://www.teamten.com/lawrence/writings/java-for-everything.html">Java for Everything</a>:

<ul>
<li><a href="https://news.ycombinator.com/item?id=8677556">Hacker News</a></li>
<li><a href="http://www.reddit.com/r/programming/duplicates/2nvybk/java_for_everything">Reddit</a></li>
</ul>
</li>
<li><a href="https://github.com/lkesteloot/java_launcher">java_launcher</a> source code</li>
<li><a href="http://groovy.codehaus.org/Differences+from+Java">Groovy Differences from Java</a></li>
<li><a href="http://groovy-lang.org/grape.html">Grape dependency manager</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Generate PermGen Leak?]]></title>
    <link href="http://halyph.com/blog/2015/02/05/how-to-generate-permgen/"/>
    <updated>2015-02-05T00:05:30+02:00</updated>
    <id>http://halyph.com/blog/2015/02/05/how-to-generate-permgen</id>
    <content type="html"><![CDATA[<p><img class="center" src="/images/blog/java.png"></p>

<p>I&rsquo;m sure that a lot of Java developers experienced <code>java.lang.OutOfMemoryError: PermGen space</code> (OOME PermGen). It was very common to get this error after multiple WAR re-deploys on Tomcat v.6.x. Permanent generation (PermGen) region of memory is used to store the internal representation of loaded classes (and much more, see here [<a href="https://plumbr.eu/blog/what-is-a-permgen-leak">1</a>] and [<a href="https://blogs.oracle.com/jonthecollector/entry/presenting_the_permanent_generation">2</a>]).</p>

<p>So, we can get <strong>OOME PermGen</strong> when ClassLoader whats to store class definition, but there is not enough space in PermGen - i.e. loaded too many classes.</p>

<p>Based on this <strong>OOME PermGen</strong> error can be generated via:</p>

<ul>
<li>decreasing PermGen size</li>
<li>loading huge amount of classes</li>
</ul>


<p>I highly recommend to read <a href="https://plumbr.eu/blog/what-is-a-permgen-leak">What is a PermGen leak?</a> post to get more info about this issue.</p>

<h3>Disclaimer</h3>

<p>The current post is totally based on <a href="https://plumbr.eu/blog/how-not-to-create-a-permgen-leak">How (not) to create a permgen leak?</a></p>

<h2>Generate PermGen leak</h2>

<p>The main idea is dynamically create a lot of classes via byte code manipulation library. We are going to use <a href="http://www.csg.ci.i.u-tokyo.ac.jp/~chiba/javassist/">Javassist</a> as it&rsquo;s the simplest library with nice API.</p>

<ul>
<li>We assume that it&rsquo;s <code>maven</code> based project. So, let&rsquo;s add Javassist to <code>pom.xml</code>.</li>
</ul>


<pre><code>&lt;project xmlns="http://maven.apache.org/POM/4.0.0" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
         xsi:schemaLocation="http://maven.apache.org/POM/4.0.0 http://maven.apache.org/xsd/maven-4.0.0.xsd"&gt;
  &lt;modelVersion&gt;4.0.0&lt;/modelVersion&gt;

  &lt;groupId&gt;com.mycompany.app&lt;/groupId&gt;
  &lt;artifactId&gt;my-app&lt;/artifactId&gt;
  &lt;version&gt;1.0-SNAPSHOT&lt;/version&gt;
  &lt;packaging&gt;jar&lt;/packaging&gt;

  &lt;name&gt;my-app&lt;/name&gt;
  &lt;url&gt;http://maven.apache.org&lt;/url&gt;

  &lt;properties&gt;
    &lt;project.build.sourceEncoding&gt;UTF-8&lt;/project.build.sourceEncoding&gt;
    &lt;skipTests&gt;true&lt;/skipTests&gt;
  &lt;/properties&gt;

  &lt;dependencies&gt;
    &lt;dependency&gt;
      &lt;groupId&gt;org.javassist&lt;/groupId&gt;
      &lt;artifactId&gt;javassist&lt;/artifactId&gt;
      &lt;version&gt;3.15.0-GA&lt;/version&gt;
    &lt;/dependency&gt;
  &lt;/dependencies&gt;

  &lt;build&gt;
    &lt;plugins&gt;
      &lt;plugin&gt;
        &lt;groupId&gt;org.codehaus.mojo&lt;/groupId&gt;
        &lt;artifactId&gt;appassembler-maven-plugin&lt;/artifactId&gt;
        &lt;version&gt;1.9&lt;/version&gt;
        &lt;configuration&gt;
          &lt;extraJvmArguments&gt;-XX:PermSize=2M -XX:MaxPermSize=4M&lt;/extraJvmArguments&gt;
          &lt;programs&gt;
            &lt;program&gt;
              &lt;mainClass&gt;com.mycompany.app.App&lt;/mainClass&gt;
              &lt;id&gt;app&lt;/id&gt;
            &lt;/program&gt;
          &lt;/programs&gt;
        &lt;/configuration&gt;
      &lt;/plugin&gt;
    &lt;/plugins&gt;
  &lt;/build&gt;
&lt;/project&gt;
</code></pre>

<ul>
<li>Also, we should set <strong>PermGen</strong> and <strong>MaxPermGen</strong> size to 2M and 4M respectively (it gives us a chance to get error as quickly as possible). Maven <code>Appassembler</code> plugin [<a href="http://mojo.codehaus.org/appassembler/appassembler-maven-plugin/usage-program-jvmsettings.html">3</a>] uses <code>extraJvmArguments</code> parameter while generating wrapper scripts: shell and batch (see <code>pom.xml</code> above, <code>&lt;extraJvmArguments&gt;-XX:PermSize=2M -XX:MaxPermSize=2M&lt;/extraJvmArguments&gt;</code>).</li>
</ul>


<blockquote><p>&ndash;XX:PermSize<size> - Set initial PermGen Size</p>

<p>&ndash;XX:MaxPermSize<size> - Set the maximum PermGen Size</p></blockquote>

<ul>
<li>Below is a simple application which dynamically creates 1000 classes to cause PermGem leak. Class creation is very simple and self explanatory. The main idea is that we should use byte code manipulation library to create classes dynamically.</li>
</ul>


<p>See additional comments in the next code snippet</p>

<p><div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kn">package</span> <span class="n">com</span><span class="o">.</span><span class="na">mycompany</span><span class="o">.</span><span class="na">app</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kn">import</span> <span class="nn">javassist.CannotCompileException</span><span class="o">;</span>
</span><span class='line'><span class="kn">import</span> <span class="nn">javassist.ClassPool</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kn">import</span> <span class="nn">java.util.concurrent.TimeUnit</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;/&lt;</span><span class="n">strong</span><span class="o">&gt;</span>
</span><span class='line'> <span class="o">*</span> <span class="n">Steps</span> <span class="n">to</span> <span class="n">build</span> <span class="n">and</span> <span class="n">run</span> <span class="n">demo</span> <span class="nl">application:</span> <span class="o">&lt;</span><span class="n">br</span> <span class="o">/&gt;</span>
</span><span class='line'> <span class="o">*</span>
</span><span class='line'> <span class="o">*</span> <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="n">mvn</span> <span class="n">clean</span> <span class="kn">package</span> <span class="nl">appassembler:</span><span class="n">assemble</span>
</span><span class='line'> <span class="o">*</span> <span class="o">&lt;</span><span class="n">li</span><span class="o">&gt;</span><span class="n">target</span><span class="o">/</span><span class="n">appassembler</span><span class="o">/</span><span class="n">bin</span><span class="o">/</span><span class="n">app</span>
</span><span class='line'> <span class="o">*</span>
</span><span class='line'> <span class="o">*/</span>
</span><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">/&lt;/</span><span class="n">strong</span><span class="o">&gt;</span>
</span><span class='line'>     <span class="o">*</span> <span class="n">We</span> <span class="n">should</span> <span class="n">use</span> <span class="kd">static</span> <span class="n">block</span> <span class="k">for</span> <span class="n">OutOfMemoryError</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="o">;</span><span class="n">initialization</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="o">;</span>
</span><span class='line'>     <span class="o">*</span> <span class="n">It</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;</span><span class="n">s</span> <span class="n">very</span> <span class="n">important</span> <span class="n">to</span> <span class="n">have</span> <span class="n">it</span><span class="o">.</span> <span class="n">In</span> <span class="n">other</span> <span class="k">case</span> <span class="n">JVM</span> <span class="n">won</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;</span><span class="n">t</span> <span class="n">be</span> <span class="n">able</span> <span class="n">to</span>
</span><span class='line'>     <span class="o">*</span> <span class="k">throw</span> <span class="o">(</span><span class="n">actually</span> <span class="n">create</span> <span class="k">new</span> <span class="n">OutOfMemoryError</span><span class="o">)</span> <span class="k">this</span> <span class="n">exception</span> <span class="n">because</span>
</span><span class='line'>     <span class="o">*</span> <span class="n">there</span> <span class="n">will</span> <span class="n">be</span> <span class="n">no</span> <span class="n">free</span> <span class="n">memory</span> <span class="k">for</span> <span class="k">this</span><span class="o">.</span> <span class="n">That</span><span class="o">&amp;</span><span class="n">rsquo</span><span class="o">;</span><span class="n">s</span> <span class="n">why</span> <span class="n">we</span> <span class="n">creating</span> <span class="n">it</span> <span class="n">beforehand</span><span class="o">.</span>
</span><span class='line'>     <span class="o">*</span> <span class="n">As</span> <span class="n">you</span> <span class="n">can</span> <span class="n">see</span> <span class="n">we</span> <span class="n">intentionally</span> <span class="n">added</span> <span class="n">output</span> <span class="n">to</span> <span class="n">highlight</span> <span class="n">that</span> <span class="n">THIS</span> <span class="n">error</span>
</span><span class='line'>     <span class="o">*</span> <span class="n">was</span> <span class="n">produces</span> <span class="n">by</span> <span class="n">us</span><span class="o">.</span>
</span><span class='line'>     <span class="o">*/</span>
</span><span class='line'>    <span class="kd">static</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">new</span> <span class="nf">OutOfMemoryError</span><span class="o">().</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>        <span class="k">try</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">TimeUnit</span><span class="o">.</span><span class="na">SECONDS</span><span class="o">.</span><span class="na">sleep</span><span class="o">(</span><span class="mi">1</span><span class="o">);</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(&amp;</span><span class="n">ldquo</span><span class="o">;=====================&amp;</span><span class="n">rdquo</span><span class="o">;);</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(&amp;</span><span class="n">ldquo</span><span class="o">;</span><span class="n">Initialized</span><span class="o">/</span><span class="n">created</span> <span class="n">OutOfMemoryError</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="o">;);</span>
</span><span class='line'>            <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(&amp;</span><span class="n">ldquo</span><span class="o">;=====================&amp;</span><span class="n">rdquo</span><span class="o">;);</span>
</span><span class='line'>        <span class="o">}</span> <span class="k">catch</span> <span class="o">(</span><span class="n">InterruptedException</span> <span class="n">e</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">e</span><span class="o">.</span><span class="na">printStackTrace</span><span class="o">();</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">Exception</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Start dynamic class creation.....\n&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&amp;</span><span class="n">lt</span><span class="o">;</span> <span class="mi">1000</span><span class="o">;</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Class</span> <span class="n">clazz</span> <span class="o">=</span> <span class="n">createClass</span><span class="o">(</span><span class="s">&quot;MyClass&quot;</span> <span class="o">+</span> <span class="n">i</span><span class="o">);</span>
</span><span class='line'>        <span class="c1">// we use this output as indicator to see the rough number of created classes</span>
</span><span class='line'>        <span class="c1">// it&#39;s not necessary to print every single (just created) class</span>
</span><span class='line'>        <span class="k">if</span><span class="o">(</span><span class="n">i</span> <span class="o">%</span> <span class="mi">50</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="n">clazz</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">private</span> <span class="kd">static</span> <span class="n">Class</span> <span class="nf">createClass</span><span class="o">(</span><span class="n">String</span> <span class="n">className</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">CannotCompileException</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">ClassPool</span> <span class="n">pool</span> <span class="o">=</span> <span class="n">ClassPool</span><span class="o">.</span><span class="na">getDefault</span><span class="o">();</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">pool</span><span class="o">.</span><span class="na">makeClass</span><span class="o">(</span><span class="n">className</span><span class="o">).</span><span class="na">toClass</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<ul>
<li>Run the application</li>
</ul>


<pre><code>$ mvn clean package appassembler:assemble
$ target/appassembler/bin/app
java.lang.OutOfMemoryError
    at com.mycompany.app.App.&lt;clinit&gt;(App.java:15)
=====================
Initialized/created OutOfMemoryError
=====================
Start dynamic class creation.....

class MyClass0
class MyClass50
class MyClass100
class MyClass150
class MyClass200
class MyClass250
class MyClass300
class MyClass350
class MyClass400
class MyClass450
class MyClass500
class MyClass550
Exception in thread "Reference Handler" java.lang.OutOfMemoryError: PermGen space
    at java.lang.ref.Reference$ReferenceHandler.run(Reference.java:140)
Exception in thread "main" java.lang.OutOfMemoryError: PermGen space
    at javassist.ClassPool.toClass(ClassPool.java:1089)
    at javassist.ClassPool.toClass(ClassPool.java:1032)
    at javassist.ClassPool.toClass(ClassPool.java:990)
    at javassist.CtClass.toClass(CtClass.java:1125)
    at com.mycompany.app.App.createClass(App.java:36)
    at com.mycompany.app.App.main(App.java:29)
</code></pre>

<p>The next command runs under the hood:
<code>java -XX:PermSize=2M -XX:MaxPermSize=4M -classpath "$CLASSPATH" com.mycompany.app.App</code></p>

<p>As you can see it was possible to create about 550 <code>MyClass</code> classes before we&rsquo;ve got an expected error.</p>

<h3>Tomcat Leaks</h3>

<p>Tomcat team created a nice <a href="http://wiki.apache.org/tomcat/MemoryLeakProtection">wiki page</a> where listed and shown the situations where leaks can be detected and fixed.</p>

<h2>References</h2>

<ul>
<li><a href="https://plumbr.eu/blog/what-is-a-permgen-leak">What is a PermGen leak?</a></li>
<li><a href="https://plumbr.eu/blog/how-not-to-create-a-permgen-leak">How (not) to create a permgen leak?</a></li>
<li><a href="http://www.infoq.com/articles/Java-PERMGEN-Removed">Where Has the Java PermGen Gone?</a> PermGen is replace with Metaspace in Java 8</li>
<li><a href="https://blogs.oracle.com/jonthecollector/entry/presenting_the_permanent_generation">Presenting the Permanent Generation</a> General intro into the subject</li>
<li><a href="http://www.javaranch.com/journal/200711/creating_java_classes_runtime_expression_evaluation.html">Javassist - Creating Java classes at runtime for evaluating numerical expressions</a> Small article how to create Java classes dynamically</li>
<li><a href="http://wiki.apache.org/tomcat/MemoryLeakProtection">Tomcat Wiki MemoryLeakProtection</a></li>
</ul>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Use Embedded H2 With Web Console?]]></title>
    <link href="http://halyph.com/blog/2015/01/22/how-to-use-embedded-h2-with-h2-console/"/>
    <updated>2015-01-22T00:55:03+02:00</updated>
    <id>http://halyph.com/blog/2015/01/22/how-to-use-embedded-h2-with-h2-console</id>
    <content type="html"><![CDATA[<p><img class="center" src="/images/blog/java.png"></p>

<p>There are several Java SQL databases which supports both server and embedded modes: <a href="http://www.h2database.com/">H2</a>, <a href="http://hsqldb.org/">HSQLDB</a> and <a href="http://db.apache.org/derby/">Derby</a>. The most interesting for me is H2 with own web <a href="http://www.h2database.com/html/quickstart.html#h2_console">Console</a>.</p>

<p>The aim of this post is to show how to connect from H2 Console to embedded in-memory H2.</p>

<blockquote><p>H2 currently supports three servers: a web server (for the H2 Console), a TCP server (for client/server connections) and an PG server (for PostgreSQL clients). <strong>Please note that only the web server supports browser connections.</strong> The servers can be started in different ways, one is using the Server tool. Starting the server doesn&rsquo;t open a database - databases are opened as soon as a client connects.</p></blockquote>

<p>The next steps have to be performed to connect to embedded DB and populate initial data:</p>

<ol>
<li>Load DB driver</li>
<li>Get <code>Connection</code></li>
<li>Create <code>Statement</code> and <code>executeUpate</code> queries</li>
<li>Create TCP <code>Server</code>. <em>We should start serve to make in-memory DB available for another process</em></li>
</ol>


<h3>Let&rsquo;s try to implement this:</h3>

<ul>
<li>Run sample application
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
<span class='line-number'>31</span>
<span class='line-number'>32</span>
<span class='line-number'>33</span>
<span class='line-number'>34</span>
<span class='line-number'>35</span>
<span class='line-number'>36</span>
<span class='line-number'>37</span>
<span class='line-number'>38</span>
<span class='line-number'>39</span>
<span class='line-number'>40</span>
<span class='line-number'>41</span>
<span class='line-number'>42</span>
<span class='line-number'>43</span>
<span class='line-number'>44</span>
<span class='line-number'>45</span>
<span class='line-number'>46</span>
<span class='line-number'>47</span>
<span class='line-number'>48</span>
<span class='line-number'>49</span>
<span class='line-number'>50</span>
<span class='line-number'>51</span>
<span class='line-number'>52</span>
<span class='line-number'>53</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="o">&lt;/</span><span class="n">li</span><span class="o">&gt;</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">ul</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;</span><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DBNAME</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="o">;</span><span class="n">mytest</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="o">;;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">SQLException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'>    <span class="c1">// open the in-memory database within a VM</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Class</span><span class="o">.</span><span class="na">forName</span><span class="o">(</span><span class="s">&quot;org.h2.Driver&quot;</span><span class="o">);</span> <span class="c1">// (1)</span>
</span><span class='line'>    <span class="n">Connection</span> <span class="n">conn</span>
</span><span class='line'>        <span class="o">=</span> <span class="n">DriverManager</span><span class="o">.</span><span class="na">getConnection</span><span class="o">(</span><span class="s">&quot;jdbc:h2:mem:&quot;</span> <span class="o">+</span> <span class="n">DBNAME</span><span class="o">,</span> <span class="s">&quot;sa&quot;</span><span class="o">,</span> <span class="s">&quot;sa&quot;</span><span class="o">);</span> <span class="c1">// (2)</span>
</span><span class='line'>    <span class="c1">// username:password are very important and must be used for connecting via H2 Console</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Statement</span> <span class="n">stat</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="na">createStatement</span><span class="o">();</span> <span class="c1">// (3)</span>
</span><span class='line'>    <span class="n">stat</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="s">&quot;create table mytbl(id int primary key, name varchar(255))&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">stat</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="s">&quot;insert into mytbl values(1, &#39;Hello&#39;)&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">stat</span><span class="o">.</span><span class="na">executeUpdate</span><span class="o">(</span><span class="s">&quot;insert into mytbl values(2, &#39;World&#39;)&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// Verify that sample data was really inserted</span>
</span><span class='line'>    <span class="n">ResultSet</span> <span class="n">rs</span> <span class="o">=</span> <span class="n">stat</span><span class="o">.</span><span class="na">executeQuery</span><span class="o">(</span><span class="s">&quot;select * from mytbl&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;ResultSet output:&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="k">while</span> <span class="o">(</span><span class="n">rs</span><span class="o">.</span><span class="na">next</span><span class="o">())</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;&amp;gt; &quot;</span> <span class="o">+</span> <span class="n">rs</span><span class="o">.</span><span class="na">getString</span><span class="o">(</span><span class="s">&quot;name&quot;</span><span class="o">));</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// start a TCP server</span>
</span><span class='line'>    <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="o">.</span><span class="na">createTcpServer</span><span class="o">().</span><span class="na">start</span><span class="o">();</span> <span class="c1">// (4)</span>
</span><span class='line'>    <span class="c1">// .. use in embedded mode ..</span>
</span><span class='line'>
</span><span class='line'>    <span class="c1">// or use it from another process:</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Server started and connection is open.&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;URL: jdbc:h2:&quot;</span> <span class="o">+</span> <span class="n">server</span><span class="o">.</span><span class="na">getURL</span><span class="o">()</span> <span class="o">+</span> <span class="s">&quot;/mem:&quot;</span> <span class="o">+</span> <span class="n">DBNAME</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;\n&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span>
</span><span class='line'>            <span class="s">&quot;now start the H2 Console in another process using:\n&quot;</span> <span class="o">+</span>
</span><span class='line'>            <span class="s">&quot;$ cd h2/bin; java -cp h2-1.4.185.jar org.h2.tools.Console -web -browser&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Press [Enter] to stop.&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">in</span><span class="o">.</span><span class="na">read</span><span class="o">();</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Stopping server and closing the connection&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">rs</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>    <span class="n">server</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</span><span class='line'>    <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>    <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(</span><span class="s">&quot;Server is STOPPED&quot;</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div>
* Output for previous run:
&#8220;`
ResultSet output:</p>

<blockquote><p>Hello
World
Server started and connection is open.
URL: jdbc:h2:tcp://192.168.1.100:9092/mem:mytest</p></blockquote>

<p>now start the H2 Console in another process using:
$ cd h2/bin; java -cp h2-1.4.185.jar org.h2.tools.Console -web -browser
Press [Enter] to stop.
<code>``
* We assume that h2 installation bundle (zip file) was downloaded (from http://www.h2database.com/html/download.html) beforehand and unpacked in some folder
* Go into H2 "install/unpack" folder and run the next command</code>cd h2/bin; java -cp h2-1.4.185.jar org.h2.tools.Console -web -browser<code>
* Now we should copy URL (from sample App output) and credentials sa/sa to login into Console
  * **URL:** jdbc:h2:tcp://192.168.1.100:9092/mem:mytest
  * **Username:** sa
  * **Password:** sa
* Login window (opened from shell by</code>org.h2.tools.Console`)
<img class="left" src="/images/posts/h2console_login.png"></p>

<p>Verify that our custom table contains just inserted values
<img class="left" src="/images/posts/h2console_sqlwindow.png"></p>

<h3>Add Embedded TCP and Web Servers</h3>

<p>Now, it&rsquo;s time to add small improvements.
The idea is to switch <em>on</em> H2 Console <strong>Web Server</strong> and <strong>TCP Server</strong> to have external access.
We should add/update item (4) in previous code snippets like this<br/>
<div class='bogus-wrapper'><notextile><figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">App</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="kd">static</span> <span class="kd">final</span> <span class="n">String</span> <span class="n">DBNAME</span> <span class="o">=</span> <span class="o">&amp;</span><span class="n">ldquo</span><span class="o">;</span><span class="n">mytest</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="o">;;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span><span class="kd">public</span> <span class="kd">static</span> <span class="kt">void</span> <span class="nf">main</span><span class="o">(</span><span class="n">String</span><span class="o">[]</span> <span class="n">args</span><span class="o">)</span> <span class="kd">throws</span> <span class="n">ClassNotFoundException</span><span class="o">,</span> <span class="n">SQLException</span><span class="o">,</span> <span class="n">IOException</span> <span class="o">{</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;&amp;</span><span class="n">hellip</span><span class="o">;&lt;/</span><span class="n">p</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">pre</span><span class="o">&gt;&lt;</span><span class="n">code</span><span class="o">&gt;</span>    <span class="n">Server</span> <span class="n">webServer</span> <span class="o">=</span> <span class="n">Server</span><span class="o">.</span><span class="na">createWebServer</span><span class="o">(</span><span class="s">&quot;-webAllowOthers&quot;</span><span class="o">,</span><span class="s">&quot;-webPort&quot;</span><span class="o">,</span><span class="s">&quot;8082&quot;</span><span class="o">).</span><span class="na">start</span><span class="o">();</span> <span class="c1">// (4a)</span>
</span><span class='line'>    <span class="n">Server</span> <span class="n">server</span> <span class="o">=</span> <span class="n">Server</span><span class="o">.</span><span class="na">createTcpServer</span><span class="o">(</span><span class="s">&quot;-tcpAllowOthers&quot;</span><span class="o">,</span><span class="s">&quot;-tcpPort&quot;</span><span class="o">,</span><span class="s">&quot;9092&quot;</span><span class="o">).</span><span class="na">start</span><span class="o">();</span>    <span class="c1">// (4b)</span>
</span><span class='line'>    <span class="c1">// .. use in embedded mode ..</span>
</span><span class='line'><span class="o">&lt;/</span><span class="n">code</span><span class="o">&gt;&lt;/</span><span class="n">pre</span><span class="o">&gt;</span>
</span><span class='line'>
</span><span class='line'><span class="o">&lt;</span><span class="n">p</span><span class="o">&gt;&amp;</span><span class="n">hellip</span><span class="o">;</span>
</span><span class='line'>        <span class="n">server</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</span><span class='line'>        <span class="n">webServer</span><span class="o">.</span><span class="na">stop</span><span class="o">();</span>
</span><span class='line'>        <span class="n">conn</span><span class="o">.</span><span class="na">close</span><span class="o">();</span>
</span><span class='line'>        <span class="n">System</span><span class="o">.</span><span class="na">out</span><span class="o">.</span><span class="na">println</span><span class="o">(&amp;</span><span class="n">ldquo</span><span class="o">;</span><span class="n">Server</span> <span class="n">is</span> <span class="n">STOPPED</span><span class="o">&amp;</span><span class="n">rdquo</span><span class="o">;);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure></notextile></div></p>

<ul>
<li>After this we can access to Web Console without running external service

<ul>
<li>Simply use URL in  browser (access to <strong>Web Server</strong>): <a href="http://localhost:8082/">http://localhost:8082/</a></li>
</ul>
</li>
<li>Use any JDBC client (see IntelliJ IDEA as a sample below)

<ul>
<li>access to <strong>TCP Server</strong>
<img class="left" src="/images/posts/h2console_idea.png"></li>
</ul>
</li>
</ul>


<h2>References</h2>

<ol>
<li><a href="http://stackoverflow.com/questions/5077584/h2-database-in-memory-mode-cannot-be-accessed-by-console">H2 database in memory mode cannot be accessed by Console</a></li>
<li><a href="http://www.h2database.com/html/tutorial.html">Official H2 Tutorial</a></li>
<li><a href="http://h2database.com/javadoc/org/h2/tools/Server.html">H2 Server methods</a></li>
<li><a href="https://github.com/halyph/tutorials/tree/master/h2-embedded-console">GitHub Sources</a></li>
</ol>

]]></content>
  </entry>
  
  <entry>
    <title type="html"><![CDATA[How to Disable Tomcat Session Serialization]]></title>
    <link href="http://halyph.com/2014/08/how-to-disable-tomcat-session.html"/>
    <updated>2014-08-12T12:57:00+03:00</updated>
    <id>http://halyph.com/2014/08/how-to-disable-tomcat-session</id>
    <content type="html"><![CDATA[<p><img class="center" src="/images/blog/java.png">
Suppose you have the next error while restart/stop Tomcat (in my case Tomcat 7.x):</p>

<pre class="brush: java;">WARNING: Cannot serialize session attribute SPRING_SECURITY_CONTEXT for session 54DBA076EDC9B7A24C1AF76824DFD1EF
java.io.NotSerializableException: com.MyClass
 at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1180)
 at java.io.ObjectOutputStream.defaultWriteFields(ObjectOutputStream.java:1528)
 at java.io.ObjectOutputStream.writeSerialData(ObjectOutputStream.java:1493)
 at java.io.ObjectOutputStream.writeOrdinaryObject(ObjectOutputStream.java:1416)
 at java.io.ObjectOutputStream.writeObject0(ObjectOutputStream.java:1174)
 at java.io.ObjectOutputStream.writeObject(ObjectOutputStream.java:346)
 at java.util.ArrayList.writeObject(ArrayList.java:710)
 at sun.reflect.NativeMethodAccessorImpl.invoke0(Native Method)
 at sun.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:57)
 at sun.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)
 at java.lang.reflect.Method.invoke(Method.java:601)
 at java.io.ObjectStreamClass.invokeWriteObject(ObjectStreamClass.java:975)
...
</pre>


<p>It means that Tomcat is trying to persist non-serializable objects which were added into the session. Tomcat uses Manager component which is used to create and maintain HTTP sessions for web application.</p>

<p>By default manager implementation configured to perform session persistence across restarts and we want to disable this functionality.</p>

<p>To disable this persistence feature, create a Context configuration file (<em>context.xml</em>) for your web application and add the following element there:</p>

<pre class="brush: xml;">&lt;Manager pathname="" /&gt;
</pre>


<p>You can add this context.xml file to:</p>

<ul>
<li>App.war:/META-INF/context.xml</li>
<li>TOMCAT_HOME/conf/Catalina/localhost/App.xml file</li>
<li>TOMCAT_HOME/cont/context.xml</li>
</ul>


<h2>References</h2>

<ul>
<li><a href="http://tomcat.apache.org/tomcat-7.0-doc/config/manager.html#Disable_Session_Persistence">Disable Session Persistence </a></li>
<li><a href="http://tomcat.apache.org/tomcat-7.0-doc/cluster-howto.html">Clustering/Session Replication HOW-TO</a></li>
</ul>

]]></content>
  </entry>
  
</feed>
